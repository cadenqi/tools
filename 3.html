<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>皮带轮参数计算器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c7da0;
            --primary-light: #61a5c2;
            --secondary: #ff9e00;
            --accent: #a61f2b;
            --light: #f8f9fa;
            --dark: #2d3e50;
            --success: #43aa8b;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --gradient: linear-gradient(135deg, #2c7da0 0%, #1a4c6f 100%);
            --bg-color: #f0f4f8;
            --pulley-color: #61a5c2;
            --nav-height: 60px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--dark);
            min-height: 100vh;
            padding: 0;
            position: relative;
            overflow-x: hidden;
        }
        
        .background-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 5% 10%, rgba(44, 125, 160, 0.03) 20px, transparent 40px),
                radial-gradient(circle at 95% 80%, rgba(255, 158, 0, 0.03) 20px, transparent 40px);
            z-index: -1;
        }
        
        /* 顶部导航栏 */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--nav-height);
            background: var(--gradient);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .logo i {
            margin-right: 10px;
            font-size: 1.4rem;
        }
        
        .nav-tabs {
            display: flex;
            height: 100%;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 4px;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0 20px;
            height: 100%;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s;
        }
        
        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* 内容区域 */
        .content {
            padding-top: var(--nav-height);
            width: 100%;
            min-height: 100vh;
        }
        
        /* 页面部分 */
        .page {
            display: none;
            padding: 20px;
            width: 100%;
            min-height: calc(100vh - var(--nav-height));
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        /* 计算器页面 */
        .calculator-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .calculator-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--pulley-color);
        }
        
        .input-section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--pulley-color);
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .input-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .input-group input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 125, 160, 0.15);
        }
        
        .pitch-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        @media (min-width: 480px) {
            .pitch-selector {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .pitch-btn {
            background: white;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            padding: 12px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .pitch-btn.active {
            background: var(--pulley-color);
            border-color: var(--pulley-color);
            color: white;
        }
        
        .pitch-btn .pitch-value {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .pitch-btn .pitch-label {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        
        .custom-pitch-container {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }
        
        .calculate-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 16px 20px;
            border-radius: 10px;
            font-size: 1.05rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            width: 100%;
            background: var(--pulley-color);
            color: white;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #4c91b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(97, 165, 194, 0.3);
        }
        
        .result-section {
            margin-top: 25px;
        }
        
        .result-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--pulley-color);
        }
        
        .result-box {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #eaeef2;
        }
        
        .result-item {
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        
        .result-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .result-label i {
            color: var(--pulley-color);
        }
        
        .result-value {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--pulley-color);
            text-align: right;
        }
        
        .result-note {
            font-size: 0.8rem;
            color: #8a8a8a;
            font-weight: normal;
            display: block;
            margin-top: 4px;
        }
        
        .note {
            margin-top: 15px;
            font-size: 0.9rem;
            color: #5a6a7e;
            background: #fffaf0;
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 3px solid var(--secondary);
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .copy-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            width: 100%;
            background: var(--success);
            color: white;
        }
        
        .copy-btn:hover {
            background: #379c80;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(67, 170, 139, 0.3);
        }
        
        /* 计算记录页面 */
        .history-section {
            margin-top: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .history-item {
            background: white;
            border-radius: 12px;
            padding: 18px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-info {
            flex: 1;
            overflow: hidden;
        }
        
        .history-type {
            font-weight: 700;
            font-size: 1.05rem;
            margin-bottom: 5px;
            color: var(--pulley-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .history-details {
            font-size: 0.92rem;
            color: #5a6a7e;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .history-date {
            font-size: 0.85rem;
            color: #8a8a8a;
        }
        
        .history-actions {
            display: flex;
            gap: 10px;
        }
        
        .history-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f4f8;
            border: none;
            color: var(--primary);
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .history-btn:hover {
            background: var(--primary-light);
            color: white;
        }
        
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #8a8a8a;
        }
        
        .empty-state i {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: #e0e6ed;
        }
        
        .empty-state p {
            margin-bottom: 10px;
        }
        
        .clear-history {
            display: block;
            width: 100%;
            padding: 15px;
            background: #f8f9fa;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            color: #5a6a7e;
            font-weight: 600;
            margin-top: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .clear-history:hover {
            background: #fff;
            border-color: var(--accent);
            color: var(--accent);
        }
        
        /* 使用说明页面 */
        .instructions-section {
            margin-top: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .instruction-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }
        
        .instruction-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instruction-content {
            color: #5a6a7e;
            line-height: 1.6;
        }
        
        .instruction-content ol, .instruction-content ul {
            padding-left: 20px;
            margin: 15px 0;
        }
        
        .instruction-content li {
            margin-bottom: 10px;
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .calculator-card, .history-item, .instruction-card {
            animation: fadeIn 0.4s ease-out;
        }
        
        /* 复制成功提示 */
        .copy-success {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: fadeIn 0.3s ease-out;
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .nav-tabs {
                padding: 2px;
            }
            
            .nav-item {
                padding: 0 12px;
                font-size: 0.9rem;
            }
            
            .calculator-card {
                padding: 20px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .header {
                padding: 0 15px;
            }
            
            .nav-item {
                padding: 0 10px;
                font-size: 0.85rem;
            }
            
            .logo {
                font-size: 1.1rem;
            }
            
            .logo i {
                font-size: 1.2rem;
            }
            
            .page {
                padding: 15px;
            }
            
            .pitch-selector {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .pitch-btn {
                padding: 10px 8px;
                font-size: 0.9rem;
            }
            
            .history-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .history-actions {
                align-self: flex-end;
            }
            
            .result-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .result-value {
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <div class="background-pattern"></div>
    
    <!-- 顶部导航栏 -->
    <div class="header">
        <div class="logo">
            <i class="fas fa-cogs"></i>
            <span>皮带轮参数计算器</span>
        </div>
        <div class="nav-tabs">
            <div class="nav-item active" data-page="calculator-page">计算</div>
            <div class="nav-item" data-page="history-page">记录</div>
            <div class="nav-item" data-page="instructions-page">说明</div>
        </div>
    </div>
    
    <!-- 内容区域 -->
    <div class="content">
        <!-- 计算器页面 -->
        <div class="page active" id="calculator-page">
            <div class="calculator-card">
                <div class="input-section">
                    <h3 class="section-title"><i class="fas fa-sliders-h"></i> 参数设置</h3>
                    
                    <div class="pitch-selector">
                        <div class="pitch-btn active" data-pitch="8">
                            <span class="pitch-value">8M</span>
                            <span class="pitch-label">儿童车</span>
                        </div>
                        <div class="pitch-btn" data-pitch="10">
                            <span class="pitch-value">10M</span>
                            <span class="pitch-label">少年车</span>
                        </div>
                        <div class="pitch-btn" data-pitch="11">
                            <span class="pitch-value">11M</span>
                            <span class="pitch-label">成人车</span>
                        </div>
                        <div class="pitch-btn" id="customBtn">
                            <span class="pitch-value">自定义</span>
                            <span class="pitch-label">其他尺寸</span>
                        </div>
                    </div>
                    
                    <div class="custom-pitch-container" id="customPitchContainer">
                        <div class="input-group">
                            <label><i class="fas fa-ruler"></i> 皮带轮节距 (mm)</label>
                            <input type="number" id="pulleyPitch" placeholder="输入皮带轮节距" min="1" step="0.1" value="8">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label><i class="fas fa-cog"></i> 皮带轮齿数 (T)</label>
                        <input type="number" id="pulleyTeeth" placeholder="输入齿数" min="1" max="1000">
                    </div>
                    
                    <button class="calculate-btn" id="calculateBtn">
                        <i class="fas fa-calculator"></i>
                        计算参数
                    </button>
                </div>
                
                <div class="result-section">
                    <h3 class="result-title"><i class="fas fa-chart-line"></i> 计算结果</h3>
                    
                    <div class="result-box">
                        <div class="result-item">
                            <span class="result-label"><i class="fas fa-circle"></i> 节圆直径≈</span>
                            <span class="result-value" id="pulleyPCD">--</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label"><i class="fas fa-arrows-alt-h"></i> 皮带轮外径≈</span>
                            <span class="result-value" id="pulleyOD">--</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label"><i class="fas fa-expand-alt"></i> 挡边外径≈</span>
                            <span class="result-value" id="pulleyFlange">--
                                <span class="result-note" id="flangeNote"></span>
                            </span>
                        </div>
                        <div class="note" id="pulleyNote">
                            输入齿数后点击计算按钮
                        </div>
                        
                        <div class="action-buttons">
                            <button class="copy-btn" id="copyBtn">
                                <i class="fas fa-copy"></i>
                                复制结果
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 计算记录页面 -->
        <div class="page" id="history-page">
            <h2><i class="fas fa-history"></i> 计算记录</h2>
            
            <div class="history-section">
                <div class="history-list" id="historyList">
                    <!-- 历史记录将通过JS动态添加 -->
                </div>
                
                <div class="empty-state" id="emptyHistory">
                    <i class="fas fa-inbox"></i>
                    <p>暂无计算记录</p>
                    <p>开始使用计算器，您的记录将显示在这里</p>
                </div>
                
                <button class="clear-history" id="clearHistoryBtn">
                    <i class="fas fa-trash"></i> 清空所有记录
                </button>
            </div>
        </div>
        
        <!-- 使用说明页面 -->
        <div class="page" id="instructions-page">
            <h2><i class="fas fa-info-circle"></i> 使用说明</h2>
            
            <div class="instructions-section">
                <div class="instruction-card">
                    <h3 class="instruction-title"><i class="fas fa-calculator"></i> 计算器使用指南</h3>
                    <div class="instruction-content">
                        <p>本工具提供皮带轮参数的专业计算功能：</p>
                        <ol>
                            <li>选择或输入皮带轮的节距（8M、10M、11M或自定义）</li>
                            <li>输入齿数（1-1000之间的整数）</li>
                            <li>点击"计算"按钮获取精确参数</li>
                            <li>计算结果会自动保存到历史记录</li>
                        </ol>
                    </div>
                </div>
                
                <div class="instruction-card">
                    <h3 class="instruction-title"><i class="fas fa-ruler"></i> 参数说明</h3>
                    <div class="instruction-content">
                        <ul>
                            <li><strong>节距</strong>：相邻两齿中心之间的距离</li>
                            <li><strong>节圆直径</strong>：理论啮合圆的直径</li>
                            <li><strong>皮带轮外径</strong>：齿顶圆的直径</li>
                            <li><strong>挡边外径</strong>：皮带轮挡边的外径</li>
                        </ul>
                    </div>
                </div>
                
                <div class="instruction-card">
                    <h3 class="instruction-title"><i class="fas fa-lightbulb"></i> 使用技巧</h3>
                    <div class="instruction-content">
                        <ul>
                            <li>常用皮带轮节距：8M、10M、11M</li>
                            <li>计算结果仅供参考，实际应用需考虑材料和工艺以及车辆设计等因素</li>
                            <li>历史记录功能可帮助您比较不同配置</li>
                            <li>使用复制功能可以方便地分享计算结果</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 获取页面元素
            // 页面切换元素
            const navItems = document.querySelectorAll('.nav-item');
            const pages = document.querySelectorAll('.page');
            
            // 皮带轮相关元素
            const pitchButtons = document.querySelectorAll('.pitch-btn');
            const customBtn = document.getElementById('customBtn');
            const customPitchContainer = document.getElementById('customPitchContainer');
            const pulleyPitchInput = document.getElementById('pulleyPitch');
            const pulleyTeethInput = document.getElementById('pulleyTeeth');
            const calculateBtn = document.getElementById('calculateBtn');
            const pulleyPCD = document.getElementById('pulleyPCD');
            const pulleyOD = document.getElementById('pulleyOD');
            const pulleyFlange = document.getElementById('pulleyFlange');
            const flangeNote = document.getElementById('flangeNote');
            const pulleyNote = document.getElementById('pulleyNote');
            const copyBtn = document.getElementById('copyBtn');
            
            // 历史记录相关元素
            const historyList = document.getElementById('historyList');
            const emptyHistory = document.getElementById('emptyHistory');
            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            
            // 当前选择的参数
            let currentPitch = 8; // 默认选择8M
            let isCustomPitch = false; // 是否使用自定义节距
            
            // 复制提示状态
            let isShowingCopySuccess = false;
            
            // 初始化
            init();
            
            // 初始化函数
            function init() {
                // 设置页面切换事件
                setupPageNavigation();
                
                // 设置皮带轮事件
                setupPulleyEvents();
                
                // 设置历史记录事件
                setupHistoryEvents();
                
                // 加载历史记录
                loadHistory();
            }
            
            // 设置页面导航
            function setupPageNavigation() {
                navItems.forEach(nav => {
                    nav.addEventListener('click', function() {
                        const pageId = this.getAttribute('data-page');
                        
                        // 更新激活的导航项
                        navItems.forEach(item => item.classList.remove('active'));
                        this.classList.add('active');
                        
                        // 显示对应的页面
                        pages.forEach(page => page.classList.remove('active'));
                        document.getElementById(pageId).classList.add('active');
                    });
                });
            }
            
            // 设置皮带轮事件
            function setupPulleyEvents() {
                // 节距按钮点击事件
                pitchButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        // 移除所有按钮的active类
                        pitchButtons.forEach(b => b.classList.remove('active'));
                        // 给当前点击的按钮添加active类
                        this.classList.add('active');
                        
                        // 检查是否点击了自定义按钮
                        if (this.id === 'customBtn') {
                            isCustomPitch = true;
                            customPitchContainer.style.display = 'block';
                        } else {
                            isCustomPitch = false;
                            customPitchContainer.style.display = 'none';
                            // 更新当前选择的节距
                            currentPitch = parseFloat(this.getAttribute('data-pitch'));
                        }
                    });
                });
                
                // 计算按钮点击事件
                calculateBtn.addEventListener('click', function() {
                    calculatePulley();
                });
                
                // 复制按钮点击事件
                copyBtn.addEventListener('click', function() {
                    copyPulleyResult();
                });
                
                // 输入框回车键计算
                pulleyTeethInput.addEventListener('keyup', function(event) {
                    if (event.key === 'Enter') {
                        calculatePulley();
                    }
                });
            }
            
            // 设置历史记录事件
            function setupHistoryEvents() {
                // 清空历史记录按钮
                clearHistoryBtn.addEventListener('click', function() {
                    if (confirm('确定要清空所有历史记录吗？')) {
                        clearHistory();
                    }
                });
            }
            
            // 计算节圆直径
            function calculatePCD(teeth, pitch) {
                return pitch / Math.sin(Math.PI / teeth);
            }
            
            // 计算皮带轮外径
            function calculatePulleyOD(pcd, pitch) {
                // 皮带轮外径 = 节圆直径 - (2 * 0.1 * 节距)
                return pcd - (2 * 0.1 * pitch);
            }
            
            // 计算挡边外径
            function calculateFlangeDiameter(od, pitch) {
                // 计算边距
                let margin;
                if (pitch === 8) {
                    margin = 3; // 8M边距3mm
                } else if (pitch === 10 || pitch === 11) {
                    margin = 3.5; // 10-11M边距3.5mm
                } else {
                    margin = 5; // 自定义边距5mm
                }
                
                // 挡边外径 = 皮带轮外径 + 边距 × 2
                return {
                    flange: od + (margin * 2),
                    margin: margin
                };
            }
            
            // 计算皮带轮参数
            function calculatePulley() {
                const teeth = parseInt(pulleyTeethInput.value);
                
                // 获取节距值
                let pitch;
                
                if (isCustomPitch) {
                    pitch = parseFloat(pulleyPitchInput.value);
                    
                    // 验证自定义节距输入
                    if (isNaN(pitch) || pitch <= 0) {
                        pulleyNote.textContent = '请输入有效的节距值';
                        return;
                    }
                } else {
                    pitch = currentPitch;
                }
                
                // 验证输入是否有效
                if (isNaN(teeth) || teeth <= 0) {
                    pulleyPCD.textContent = '--';
                    pulleyOD.textContent = '--';
                    pulleyFlange.textContent = '--';
                    flangeNote.textContent = '';
                    pulleyNote.textContent = '请输入有效的齿数';
                    return;
                }
                
                // 计算节圆直径
                const pcd = calculatePCD(teeth, pitch);
                
                // 计算皮带轮外径
                const od = calculatePulleyOD(pcd, pitch);
                
                // 计算挡边外径
                const flangeResult = calculateFlangeDiameter(od, pitch);
                const flange = flangeResult.flange;
                const margin = flangeResult.margin;
                
                // 更新UI显示结果
                pulleyPCD.textContent = `${pcd.toFixed(2)}mm`;
                pulleyOD.textContent = `${od.toFixed(2)}mm`;
                pulleyFlange.textContent = `${flange.toFixed(2)}mm`;
                
                // 添加挡边备注
                flangeNote.textContent = `(边距: ${margin}mm × 2)`;
                
                pulleyNote.textContent = `基于${pitch}mm节距计算`;
                
                // 存储结果用于复制
                const result = {
                    teeth: teeth,
                    pitch: pitch,
                    pcd: pcd,
                    od: od,
                    flange: flange,
                    margin: margin,
                    type: 'pulley'
                };
                
                window.pulleyResult = result;
                
                // 自动保存到历史记录
                saveToHistory(result);
            }
            
            // 复制皮带轮计算结果
            function copyPulleyResult() {
                if (!window.pulleyResult) {
                    alert('请先进行计算');
                    return;
                }
                
                const result = window.pulleyResult;
                const copyText = `${result.pitch}M皮带轮${result.teeth}T：节圆直径≈${result.pcd.toFixed(2)}mm，外径≈${result.od.toFixed(2)}mm，挡边外径≈${result.flange.toFixed(2)}mm`;
                
                copyToClipboard(copyText);
            }
            
            // 复制到剪贴板函数
            function copyToClipboard(text) {
                if (isShowingCopySuccess) return;
                
                // 兼容手机端的复制方法
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.top = 0;
                textArea.style.left = 0;
                textArea.style.width = '2em';
                textArea.style.height = '2em';
                textArea.style.padding = 0;
                textArea.style.border = 'none';
                textArea.style.outline = 'none';
                textArea.style.boxShadow = 'none';
                textArea.style.background = 'transparent';
                
                document.body.appendChild(textArea);
                textArea.select();
                
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        showCopySuccess('已复制到剪贴板');
                    } else {
                        alert('复制失败，请手动复制结果');
                    }
                } catch (err) {
                    alert('复制失败，请手动复制结果');
                }
                
                document.body.removeChild(textArea);
            }
            
            // 显示操作成功提示
            function showCopySuccess(message) {
                if (isShowingCopySuccess) return;
                
                isShowingCopySuccess = true;
                
                // 移除可能存在的旧提示
                const oldSuccess = document.querySelector('.copy-success');
                if (oldSuccess) {
                    document.body.removeChild(oldSuccess);
                }
                
                const successDiv = document.createElement('div');
                successDiv.className = 'copy-success';
                successDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
                
                document.body.appendChild(successDiv);
                
                setTimeout(function() {
                    if (document.body.contains(successDiv)) {
                        document.body.removeChild(successDiv);
                    }
                    isShowingCopySuccess = false;
                }, 2000);
            }
            
            // 保存到历史记录
            function saveToHistory(result) {
                // 获取现有历史记录
                let history = JSON.parse(localStorage.getItem('pulleyHistory') || '[]');
                
                // 添加时间戳
                result.timestamp = new Date().toISOString();
                result.date = new Date().toLocaleString();
                
                // 添加到历史记录
                history.unshift(result);
                
                // 限制历史记录数量（最多20条）
                if (history.length > 20) {
                    history = history.slice(0, 20);
                }
                
                // 保存到本地存储
                localStorage.setItem('pulleyHistory', JSON.stringify(history));
                
                // 刷新历史记录显示
                loadHistory();
            }
            
            // 加载历史记录
            function loadHistory() {
                const history = JSON.parse(localStorage.getItem('pulleyHistory') || '[]');
                
                // 清空现有显示
                historyList.innerHTML = '';
                
                if (history.length === 0) {
                    emptyHistory.style.display = 'block';
                    return;
                }
                
                emptyHistory.style.display = 'none';
                
                // 添加历史记录项
                history.forEach((item, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    
                    const typeText = `${item.pitch}M皮带轮 ${item.teeth}T`;
                    const detailsText = `节圆直径: ${item.pcd.toFixed(2)}mm, 外径: ${item.od.toFixed(2)}mm, 挡边: ${item.flange.toFixed(2)}mm`;
                    
                    historyItem.innerHTML = `
                        <div class="history-info">
                            <div class="history-type">${typeText}</div>
                            <div class="history-details">${detailsText}</div>
                            <div class="history-date">${item.date}</div>
                        </div>
                        <div class="history-actions">
                            <button class="history-btn" data-index="${index}">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="history-btn" data-index="${index}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    historyList.appendChild(historyItem);
                });
                
                // 添加历史记录项的事件
                document.querySelectorAll('.history-actions .history-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        const history = JSON.parse(localStorage.getItem('pulleyHistory') || '[]');
                        
                        if (this.querySelector('.fa-copy')) {
                            // 复制操作
                            copyHistoryItem(history[index]);
                        } else if (this.querySelector('.fa-trash')) {
                            // 删除操作
                            deleteHistoryItem(index);
                        }
                    });
                });
            }
            
            // 复制历史记录项
            function copyHistoryItem(item) {
                const copyText = `${item.pitch}M皮带轮${item.teeth}T：节圆直径≈${item.pcd.toFixed(2)}mm，外径≈${item.od.toFixed(2)}mm，挡边外径≈${item.flange.toFixed(2)}mm`;
                copyToClipboard(copyText);
            }
            
            // 删除历史记录项
            function deleteHistoryItem(index) {
                let history = JSON.parse(localStorage.getItem('pulleyHistory') || '[]');
                
                if (index >= 0 && index < history.length) {
                    history.splice(index, 1);
                    localStorage.setItem('pulleyHistory', JSON.stringify(history));
                    loadHistory();
                }
            }
            
            // 清空历史记录
            function clearHistory() {
                localStorage.removeItem('pulleyHistory');
                loadHistory();
            }
        });
    </script>
</body>
</html>