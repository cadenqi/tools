<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JKaero工具箱|自行车工程工具集</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ===== 基础样式设置 ===== */
        :root {
            --primary: #1a365d;
            --secondary: #2a69ac;
            --accent: #38b2ac;
            --light: #f8fafc;
            --dark: #2d3748;
            --text: #2d3748;
            --background: #f7fafc;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --header-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            --nav-height: 56px;
            --sticky-header-height: 180px;
            --sticky-specs-height: 220px;
            --sticky-knowledge-height: 70px;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Noto Sans SC', 'Montserrat', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background-color: var(--background);
            padding: 0;
            overflow-x: hidden;
            /* 防止滑动返回时的白屏问题 */
            -webkit-overflow-scrolling: touch;
            height: 100vh;
        }
        
        .app-container {
            max-width: 100%;
            margin: 0 auto;
            padding-bottom: var(--nav-height);
            height: 100%;
            position: relative;
        }
        
        /* ===== 页面容器 ===== */
        .page {
            display: none;
            min-height: calc(100vh - var(--nav-height));
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            background-color: var(--background);
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ===== 底部导航 ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 6px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            height: var(--nav-height);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #718096;
            font-size: 0.65rem;
            padding: 4px 0;
            flex: 1;
            max-width: 33.33%;
            transition: all 0.2s;
        }
        
        .nav-item.active {
            color: var(--secondary);
        }
        
        .nav-icon {
            font-size: 1rem;
            margin-bottom: 2px;
        }
        
        /* ===== 工具页面样式 ===== */
        #toolsPage {
            padding-top: var(--sticky-header-height);
        }
        
        .tools-sticky-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--sticky-header-height);
            z-index: 100;
            background: var(--background);
        }
        
        /* 轮播图样式 - 自适应优化 */
        .carousel {
            width: 100%;
            height: 130px;
            position: relative;
            overflow: hidden;
        }
        
        .carousel-inner {
            display: flex;
            transition: transform 0.5s ease;
            height: 100%;
        }
        
        .carousel-item {
            min-width: 100%;
            height: 100%;
            position: relative;
        }
        
        .carousel-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .carousel-indicators {
            position: absolute;
            bottom: 10px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 8px;
            z-index: 5;
        }
        
        .carousel-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
        }
        
        .carousel-indicator.active {
            background: white;
        }
        
        /* 分类导航 */
        .category-nav {
            display: flex;
            overflow-x: auto;
            margin: 0;
            gap: 8px;
            padding: 10px 15px;
            -webkit-overflow-scrolling: touch;
            background: var(--background);
        }
        
        .category-btn {
            padding: 8px 12px;
            background: white;
            border: none;
            border-radius: 18px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            white-space: nowrap;
            box-shadow: var(--card-shadow);
            transition: all 0.2s;
        }
        
        .category-btn.active {
            background: var(--secondary);
            color: white;
        }
        
        /* 工具内容区域 */
        .tools-content {
            padding: 15px;
            height: calc(100vh - var(--nav-height) - var(--sticky-header-height));
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tool-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
        }
        
        .tool-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s;
            box-shadow: var(--card-shadow);
            cursor: pointer;
            height: 180px;
            display: flex;
            flex-direction: column;
        }
        
        .tool-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .tool-image {
            height: 110px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f4f8;
        }
        
        .tool-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .tool-card:hover .tool-image img {
            transform: scale(1.05);
        }
        
        .tool-content {
            padding: 12px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .tool-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--primary);
            text-align: center;
        }
        
        .tool-desc {
            font-size: 0.75rem;
            color: #718096;
            text-align: center;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* ===== 选型表页面样式 ===== */
        #specsPage {
            padding-top: var(--sticky-specs-height);
        }
        
        .specs-sticky-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--sticky-specs-height);
            z-index: 100;
            background: var(--background);
            padding: 15px 15px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .specs-ad {
            width: 100%;
            margin-bottom: 10px;
            overflow: hidden;
            /* 固定高度，防止图片加载失败时布局错乱 */
            height: 90px;
            background: #f0f4f8;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }
        
        .specs-ad img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .specs-search {
            position: relative;
            margin-bottom: 10px;
        }
        
        .specs-search input {
            width: 100%;
            padding: 12px 15px 12px 15px; /* 增加右侧内边距为按钮留空间 */
            border: 1px solid #e2e8f0;
            border-radius: 25px;
            font-size: 0.95rem;
        }
        
        .specs-search button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--accent);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            color: white;
            cursor: pointer;
            z-index: 10; /* 确保按钮在最上层 */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .specs-tabs {
            display: flex;
            margin-bottom: 0;
            border-bottom: 1px solid #e2e8f0;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .specs-tab {
            padding: 10px 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #718096;
            position: relative;
            font-size: 0.9rem;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .specs-tab.active {
            color: var(--secondary);
        }
        
        .specs-tab.active::after {
            content: "";
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--secondary);
        }
        
        /* 选型表内容区域 */
        .specs-content {
            padding: 15px;
            height: calc(100vh - var(--nav-height) - var(--sticky-specs-height));
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .specs-table-container {
            width: 100%;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            background: white;
            overflow: hidden;
        }
        
        .specs-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            table-layout: fixed;
        }
        
        .specs-table th, .specs-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            word-wrap: break-word;
        }
        
        .specs-table th {
            background: #f7fafc;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .specs-table tr:last-child td {
            border-bottom: none;
        }
        
        /* 调整表格列宽 */
        .specs-table th:nth-child(1),
        .specs-table td:nth-child(1) {
            width: 40%;
        }
        
        .specs-table th:nth-child(2),
        .specs-table td:nth-child(2) {
            width: 30%;
            text-align: center;
        }
        
        .specs-table th:nth-child(3),
        .specs-table td:nth-child(3) {
            width: 30%;
            text-align: center;
        }
        
        /* ===== 知识库页面样式 ===== */
        #knowledgePage {
            padding-top: var(--sticky-knowledge-height);
        }
        
        .knowledge-sticky-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--sticky-knowledge-height);
            z-index: 100;
            background: var(--background);
            padding: 15px 15px 0;
        }
        
        .knowledge-ad {
            width: 100%;
            overflow: hidden;
            /* 固定高度，防止图片加载失败时布局错乱 */
            height: 80px;
            background: #f0f4f8;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }
        
        .knowledge-ad img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        
        /* 知识库内容区域 - 优化后的样式 */
        .knowledge-content {
            padding: 15px;
            min-height: calc(100vh - var(--nav-height) - var(--sticky-knowledge-height));
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .knowledge-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .knowledge-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            cursor: pointer;
            transition: all 0.3s;
            padding: 20px;
            position: relative;
            border-left: 4px solid var(--accent);
            display: flex;
            flex-direction: column;
            min-height: 120px;
            justify-content: center;
        }
        
        .knowledge-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
            border-left-color: var(--secondary);
        }
        
        .knowledge-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
            line-height: 1.3;
        }
        
        .knowledge-title i {
            margin-right: 10px;
            color: var(--accent);
            font-size: 1.2rem;
        }
        
        .knowledge-desc {
            color: #718096;
            line-height: 1.5;
            font-size: 0.9rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* 知识库分类标签 */
        .knowledge-category {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--accent);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        /* 额外信息区域 - 优化样式 */
        .additional-info {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
        }
        
        .info-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .info-section:last-child {
            margin-bottom: 0;
            border-bottom: none;
            padding-bottom: 0;
        }
        
        .info-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--primary);
            display: flex;
            align-items: center;
        }
        
        .info-title i {
            margin-right: 8px;
            color: var(--accent);
        }
        
        .info-content {
            color: #718096;
            line-height: 1.6;
        }
        
        .contact-list {
            list-style: none;
        }
        
        .contact-list li {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            padding: 5px 0;
        }
        
        .contact-list i {
            margin-right: 10px;
            color: var(--accent);
            width: 20px;
            text-align: center;
        }
        
        /* 公众号二维码样式 */
        .qrcode-container {
            margin-top: 15px;
            text-align: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .qrcode {
            width: 150px;
            height: 150px;
            margin: 0 auto;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .qrcode img {
            max-width: 100%;
            max-height: 100%;
        }
        
        .qrcode-text {
            margin-top: 8px;
            font-size: 0.9rem;
            color: var(--secondary);
            font-weight: 500;
        }
        
        /* ===== 工具展示区 ===== */
        .tool-display-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 1000;
            display: none;
            flex-direction: column;
        }
        
        .tool-display-content {
            flex: 1;
            width: 100%;
            border: none;
            height: 100%;
        }
        
        /* ===== 关闭按钮 ===== */
        .close-button {
            position: fixed;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            transition: all 0.3s;
        }
        
        .close-button:hover {
            background: rgba(0, 0, 0, 0.7);
            transform: scale(1.1);
        }
        
        /* ===== 响应式设计 ===== */
        @media (min-width: 768px) {
            .tool-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .knowledge-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            :root {
                --sticky-specs-height: 200px;
                --sticky-knowledge-height: 90px;
            }
            
            .specs-ad {
                height: 80px;
            }
            
            .knowledge-ad {
                height: 80px;
            }
            
            .additional-info {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .info-section {
                border-bottom: none;
                padding-bottom: 0;
            }
            
            .specs-table th:nth-child(1),
            .specs-table td:nth-child(1) {
                width: 35%;
            }
            
            .specs-table th:nth-child(2),
            .specs-table td:nth-child(2) {
                width: 25%;
            }
            
            .specs-table th:nth-child(3),
            .specs-table td:nth-child(3) {
                width: 40%;
            }
        }
        
        @media (min-width: 1024px) {
            .tool-grid {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            }
            
            .knowledge-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .app-container {
                max-width: 1200px;
            }
            
            :root {
                --sticky-specs-height: 190px;
                --sticky-knowledge-height: 85px;
            }
            
            .additional-info {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            :root {
                --sticky-specs-height: 220px;
            }
            
            .specs-tab {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
            
            .specs-table th, .specs-table td {
                padding: 10px 12px;
                font-size: 0.85rem;
            }
            
            .specs-table th:nth-child(1),
            .specs-table td:nth-child(1) {
                width: 45%;
            }
            
            .specs-table th:nth-child(2),
            .specs-table td:nth-child(2) {
                width: 25%;
            }
            
            .specs-table th:nth-child(3),
            .specs-table td:nth-child(3) {
                width: 30%;
            }
            
            .knowledge-card {
                padding: 15px;
                min-height: 100px;
            }
            
            .knowledge-title {
                font-size: 1rem;
            }
        }
        
        /* ===== 搜索结果显示 ===== */
        .search-result {
            text-align: center;
            padding: 20px;
            color: #718096;
        }
        
        /* 加载指示器 */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--secondary);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ===== 新增：链接处理提示样式 ===== */
        .link-handler {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .link-handler-content {
            background: white;
            border-radius: 12px;
            padding: 25px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .link-handler-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .link-handler-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .link-handler-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .link-handler-btn.primary {
            background: var(--secondary);
            color: white;
        }
        
        .link-handler-btn.secondary {
            background: #e2e8f0;
            color: var(--dark);
        }
        
        /* PDF预览样式 */
        .pdf-preview-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 2000;
            display: none;
            flex-direction: column;
        }
        
        .pdf-preview-header {
            padding: 15px;
            background: var(--primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .pdf-preview-content {
            flex: 1;
            width: 100%;
            border: none;
        }
        
        /* 知识库卡片增强样式 */
        .link-type-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        /* 新增：外部链接图标 */
        .external-link-icon {
            margin-left: 5px;
            font-size: 0.8rem;
            color: var(--accent);
        }
        
        /* 修复：防止页面滚动穿透 */
        .no-scroll {
            overflow: hidden;
            height: 100%;
            position: fixed;
            width: 100%;
        }
        
        /* 错误提示样式 */
        .error-message {
            text-align: center;
            padding: 20px;
            color: #e74c3c;
            background: #ffeaea;
            border-radius: 8px;
            margin: 10px;
        }
        
        .retry-button {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        /* 微信浏览器特定样式修复 */
        .wechat-fix {
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>
<body class="wechat-fix">
    <div class="app-container">
        <!-- ===== 工具页面 ===== -->
        <div id="toolsPage" class="page active">
            <!-- 固定顶部区域：轮播图 + 分类导航 -->
            <div class="tools-sticky-header">
                <!-- 轮播图 -->
                <div class="carousel" id="carousel">
                    <div class="carousel-inner" id="carouselInner">
                        <div class="carousel-item">
                            <img src="https://raw.githubusercontent.com/cadenqi/tools/main/images/banner1.jpg" alt="轮播图1">
                        </div>
                        <div class="carousel-item">
                            <img src="https://raw.githubusercontent.com/cadenqi/tools/main/images/banner2.jpg" alt="轮播图2" onerror="this.src='https://placehold.co/600x300/3498db/white?text=JKaero工具箱'">
                        </div>
                        <div class="carousel-item">
                            <img src="https://raw.githubusercontent.com/cadenqi/tools/main/images/banner3.jpg" alt="轮播图3" onerror="this.src='https://placehold.co/600x300/3498db/white?text=JKaero工具箱'">
                        </div>
                    </div>
                    <div class="carousel-indicators" id="carouselIndicators">
                        <div class="carousel-indicator active" data-index="0"></div>
                        <div class="carousel-indicator" data-index="1"></div>
                        <div class="carousel-indicator" data-index="2"></div>
                    </div>
                </div>
                
                <!-- 分类导航 -->
                <div class="category-nav">
                    <button class="category-btn active" data-category="all">
                        <i class="fas fa-th"></i> 所有工具
                    </button>
                    <button class="category-btn" data-category="chain">
                        <i class="fas fa-link"></i> 链条驱动
                    </button>
                    <button class="category-btn" data-category="belt">
                        <i class="fas fa-cog"></i> 皮带驱动
                    </button>
                    <button class="category-btn" data-category="electric">
                        <i class="fas fa-bolt"></i> 电驱动
                    </button>
                    <button class="category-btn" data-category="other">
                        <i class="fas fa-ellipsis-h"></i> 其他
                    </button>
                </div>
            </div>
            
            <!-- 工具内容区域（可滑动） -->
            <div class="tools-content">
                <div class="tool-grid" id="toolGrid">
                    <!-- 工具卡片将通过JavaScript动态加载 -->
                </div>
            </div>
        </div>
        
        <!-- ===== 选型表页面 ===== -->
        <div id="specsPage" class="page">
            <!-- 固定顶部区域：广告 + 搜索 + 标签 -->
            <div class="specs-sticky-header">
                <div class="specs-ad">
                    <img src="https://raw.githubusercontent.com/cadenqi/tools/main/images/banner1.jpg" alt="赞助商广告" onerror="this.src='https://placehold.co/600x150/1a365d/white?text=JKaero选型表'">
                </div>
                
                <div class="specs-search">
                    <input type="text" placeholder="搜索规格..." id="specSearchInput">
                    <button id="specSearchBtn"><i class="fas fa-search"></i></button>
                </div>
                
                <div class="specs-tabs">
                    <button class="specs-tab active" data-spec="11M">11M规格</button>
                    <button class="specs-tab" data-spec="10M">10M规格</button>
                    <button class="specs-tab" data-spec="8M">8M规格</button>
                </div>
            </div>
            
            <!-- 选型表内容区域（可滑动） -->
            <div class="specs-content">
                <div class="specs-table-container">
                    <table class="specs-table" id="specsTable">
                        <thead>
                            <tr>
                                <th>型号</th>
                                <th>齿数/T</th>
                                <th>长度/mm</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 规格数据将通过JavaScript动态加载 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- ===== 知识库页面 ===== -->
        <div id="knowledgePage" class="page">
            <!-- 固定顶部区域：广告 -->
            <div class="knowledge-sticky-header">
                <div class="knowledge-ad">
                    <img src="https://raw.githubusercontent.com/cadenqi/tools/main/images/banner2.jpg" alt="知识库广告" onerror="this.src='https://placehold.co/600x150/2a69ac/white?text=JKaero知识库'">
                </div>
            </div>
            
            <!-- 知识库内容区域（可滑动） -->
            <div class="knowledge-content">
                <div class="knowledge-grid" id="knowledgeGrid">
                    <!-- 知识库卡片将通过JavaScript动态加载 -->
                </div>
                
                <!-- 额外信息区域 -->
                <div class="additional-info">
                    <div class="info-section">
                        <h3 class="info-title"><i class="fas fa-tools"></i> 工具介绍</h3>
                        <div class="info-content">
                            <p>JKaero工具箱是一款专业级的自行车驱动系统辅助选型设计与工程计算软件，提供专业的自行车设计与工程计算工具，涵盖几何计算、材料分析、性能检测、模拟等多个领域，助力工程师和爱好者进行精准设计和优化。</p>
                        </div>
                    </div>
                    
                    <div class="info-section">
                        <h3 class="info-title"><i class="fas fa-info-circle"></i> 关于我们</h3>
                        <div class="info-content">
                            <p>我们是一支深耕自行车工程技术领域的专业团队，同时也是一家专注于两轮车驱动系统制造的公司。我们致力于为两轮车行业匠心打造精准高效的驱动系统，同时提供全方位的技术支持，更以推动自行车设计与制造技术的革新进步为目标，不断探索前行。我们的使命是成为最具价值的两轮车核心系统提供商。期待携手您共同推动自行车设计与制造的技术进步。</p>
                        </div>
                    </div>
                    
                    <div class="info-section">
                        <h3 class="info-title"><i class="fas fa-headset"></i> 技术支持</h3>
                        <div class="info-content">
                            <ul class="contact-list">
                                <li><i class="fas fa-envelope"></i> 邮箱：sales@szjiankun.com</li>
                                <li><i class="fas fa-phone"></i> 电话：0755-23272300</li>
                                <li><i class="fas fa-globe"></i> 网址：www.szjiankun.com</li>
                                <li><i class="fas fa-map-marker-alt"></i> 地址：深圳市光明新区新湖街道办楼村鲤鱼河工业区振兴路10号</li>
                            </ul>
                            <div class="qrcode-container">
                                <div class="qrcode">
                                    <img src="https://raw.githubusercontent.com/cadenqi/tools/main/images/GZH.jpg" alt="公众号二维码" onerror="this.src='https://placehold.co/150x150/38b2ac/white?text=公众号二维码'">
                                </div>
                                <div class="qrcode-text">扫码关注我们的公众号</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ===== 工具展示容器 ===== -->
    <div class="tool-display-container" id="toolDisplay">
        <iframe class="tool-display-content" id="toolFrame" src="about:blank"></iframe>
    </div>
    
    <!-- ===== 关闭按钮 ===== -->
    <button class="close-button" id="closeTool">
        <i class="fas fa-times"></i>
    </button>
    
    <!-- ===== 底部导航 ===== -->
    <div class="bottom-nav">
        <a href="#" class="nav-item active" data-page="toolsPage">
            <div class="nav-icon"><i class="fas fa-tools"></i></div>
            <div>工具</div>
        </a>
        <a href="#" class="nav-item" data-page="specsPage">
            <div class="nav-icon"><i class="fas fa-table"></i></div>
            <div>选型表</div>
        </a>
        <a href="#" class="nav-item" data-page="knowledgePage">
            <div class="nav-icon"><i class="fas fa-book"></i></div>
            <div>知识库</div>
        </a>
    </div>

    <!-- ===== 新增：链接处理提示 ===== -->
    <div class="link-handler" id="linkHandler">
        <div class="link-handler-content">
            <h3 class="link-handler-title" id="linkHandlerTitle">打开链接</h3>
            <p id="linkHandlerMessage">您即将离开JKaero工具箱访问外部网站。</p>
            <div class="link-handler-buttons">
                <button class="link-handler-btn secondary" id="cancelLink">取消</button>
                <button class="link-handler-btn primary" id="confirmLink">继续</button>
            </div>
        </div>
    </div>
    
    <!-- ===== 新增：PDF预览容器 ===== -->
    <div class="pdf-preview-container" id="pdfPreview">
        <div class="pdf-preview-header">
            <span id="pdfTitle">PDF预览</span>
            <button id="closePdfPreview"><i class="fas fa-times"></i></button>
        </div>
        <iframe class="pdf-preview-content" id="pdfFrame"></iframe>
    </div>

    <script>
        // ==================== 模块化重构：JKaero工具箱应用 ====================
        
        /**
         * 微信浏览器检测和兼容性处理
         */
        const WechatHelper = {
            isWechatBrowser: function() {
                return /micromessenger/i.test(navigator.userAgent);
            },
            
            /**
             * 初始化微信浏览器特定处理
             */
            init: function() {
                if (this.isWechatBrowser()) {
                    console.log("检测到微信浏览器，启用特殊处理");
                    this.handleWechatPageLifecycle();
                }
            },
            
            /**
             * 处理微信浏览器页面生命周期
             */
            handleWechatPageLifecycle: function() {
                // 监听页面可见性变化
                document.addEventListener('visibilitychange', () => {
                    if (document.visibilityState === 'visible') {
                        // 页面重新可见（从后台切回）
                        console.log("微信浏览器页面重新激活");
                        this.restorePageState();
                    } else {
                        // 页面隐藏（最小化或切换）
                        console.log("微信浏览器页面隐藏，保存状态");
                        this.savePageState();
                    }
                });
                
                // 监听页面卸载（微信可能会直接销毁页面）
                window.addEventListener('beforeunload', () => {
                    this.savePageState();
                });
                
                // 监听页面加载完成
                window.addEventListener('load', () => {
                    this.restorePageState();
                });
            },
            
            /**
             * 保存页面状态到sessionStorage（微信专用）
             */
            savePageState: function() {
                try {
                    const state = {
                        timestamp: Date.now(),
                        currentPage: StateManager.getState().currentPage,
                        toolDisplayState: StateManager.getSessionState(),
                        activeCategory: StateManager.getState().activeCategory,
                        activeSpecTab: StateManager.getState().activeSpecTab
                    };
                    sessionStorage.setItem('wechatPageState', JSON.stringify(state));
                } catch (e) {
                    console.error("保存微信页面状态失败:", e);
                }
            },
            
            /**
             * 从sessionStorage恢复页面状态（微信专用）
             */
            restorePageState: function() {
                try {
                    const savedState = sessionStorage.getItem('wechatPageState');
                    if (savedState) {
                        const state = JSON.parse(savedState);
                        const now = Date.now();
                        
                        // 只恢复5分钟内的状态
                        if (now - state.timestamp < 5 * 60 * 1000) {
                            console.log("恢复微信页面状态");
                            
                            // 恢复页面状态
                            StateManager.updateState({
                                currentPage: state.currentPage,
                                activeCategory: state.activeCategory,
                                activeSpecTab: state.activeSpecTab
                            });
                            
                            // 恢复会话状态
                            StateManager.updateSessionState(state.toolDisplayState);
                            
                            // 切换到正确的页面
                            HistoryManager.switchToPage(state.currentPage, false);
                            
                            // 恢复工具显示（如果需要）
                            if (state.toolDisplayState.toolDisplayOpen) {
                                setTimeout(() => {
                                    ToolDisplayManager.openToolDisplay(
                                        state.toolDisplayState.lastToolUrl,
                                        state.toolDisplayState.lastToolTitle
                                    );
                                }, 500);
                            }
                        } else {
                            console.log("微信页面状态已过期，清除");
                            sessionStorage.removeItem('wechatPageState');
                        }
                    }
                } catch (e) {
                    console.error("恢复微信页面状态失败:", e);
                }
            }
        };

        /**
         * 数据管理模块 - 负责管理工具、规格和知识库数据
         */
        const DataManager = {
            // 工具数据配置（按ID从大到小排序，ID越大显示越靠前）
            toolsData: [
                {
                    id: 10,
                    title: "皮带皮带轮RC参数计算器",
                    category: "belt",
                    description: "以皮带皮带轮为条件计算齿比以及RC值",
                    image: "https://placehold.co/600x400/e74c3c/white?text=JKaero",
                    link: "https://cadenqi.github.io/tools/10",
                    uses: 789
                },
                {
                    id: 9,
                    title: "皮带直线度检测分析工具",
                    category: "belt",
                    description: "基于图像处理分析系统，对皮带系统的直线度检检验测量",
                    image: "https://placehold.co/600x400/9b59b6/white?text=JKaero",
                    link: "https://cadenqi.github.io/tools/9",
                    uses: 523
                },
                {
                    id: 8,
                    title: "材质重量分析",
                    category: "other",
                    description: "分析计算不同材质、形状的重量以及单价计算",
                    image: "https://placehold.co/600x400/3498db/white?text=JKaero",
                    link: "https://cadenqi.github.io/tools/8",
                    uses: 678
                },
                {
                    id: 7,
                    title: "皮带张力频率分析",
                    category: "belt",
                    description: "分析自行车皮带张力数据，判断张力是否均匀",
                    image: "https://placehold.co/600x400/1abc9c/white?text=JKaero",
                    link: "https://cadenqi.github.io/tools/7",
                    uses: 432
                },
                {
                    id: 6,
                    title: "自行车RC设计计算器",
                    category: "other",
                    description: "基于不同条件来合理设计自行车的RC尺寸",
                    image: "https://placehold.co/600x400/e74c3c/white?text=JKaero",
                    link: "https://cadenqi.github.io/tools/6",
                    uses: 945
                },
                {
                    id: 5,
                    title: "自行车驱动系统换算工具",
                    category: "other",
                    description: "将现有链条驱动系统平替链条为皮带系统，转换计算工具",
                    image: "https://placehold.co/600x400/f39c12/white?text=JKaero",
                    link: "https://cadenqi.github.io/tools/5",
                    uses: 723
                },
                {
                    id: 4,
                    title: "齿盘参数计算器",
                    category: "chain",
                    description: "计算12.7节距齿盘的外径等相关参数",
                    image: "https://placehold.co/600x400/9b59b6/white?text=JKaero",
                    link: "https://cadenqi.github.io/tools/4",
                    uses: 567
                },
                {
                    id: 3,
                    title: "皮带轮参数计算器器",
                    category: "belt",
                    description: "可计算11M、10M、8M皮带轮的外径等数据",
                    image: "https://placehold.co/600x400/e74c3c/white?text=JKaero",
                    link: "https://cadenqi.github.io/tools/3",
                    uses: 856
                },
                {
                    id: 2,
                    title: "皮带轮与齿盘换算器",
                    category: "belt",
                    description: "计算不同齿比下的速度、踏频关系，优化传动系统设计",
                    image: "https://placehold.co/600x400/2ecc71/white?text=JKaero",
                    link: "https://cadenqi.github.io/tools/2",
                    uses: 892
                },
                {
                    id: 1,
                    title: "自行车皮带长度计算器",
                    category: "belt",
                    description: "计算皮带驱动系统自行车皮带长度与选型参数等",
                    image: "https://placehold.co/600x400/3498db/white?text=JKaero",
                    link: "https://cadenqi.github.io/tools/1",
                    uses: 1243
                }
            ],

            // 规格数据配置
            specsData: {
                "11M": [
                    { model: "11M-825-12", spec: "75", applicable: "825" },
                    { model: "11M-858-12", spec: "78", applicable: "858" },
                    { model: "11M-1001-12", spec: "91", applicable: "1001" },
                    { model: "11M-1100-12", spec: "100", applicable: "1100" },
                    { model: "11M-1122-12", spec: "102", applicable: "1122" },
                    { model: "11M-1155-12", spec: "105", applicable: "1155" },
                    { model: "11M-1166-12", spec: "106", applicable: "1166" },
                    { model: "11M-1188-12", spec: "108", applicable: "1188" },
                    { model: "11M-1199-12", spec: "109", applicable: "1199" },
                    { model: "11M-1221-12", spec: "111", applicable: "1221" },
                    { model: "11M-1243-12", spec: "113", applicable: "1243" },
                    { model: "11M-1254-12", spec: "114", applicable: "1254" },
                    { model: "11M-1265-12", spec: "115", applicable: "1265" },
                    { model: "11M-1276-12", spec: "116", applicable: "1276" },
                    { model: "11M-1287-12", spec: "117", applicable: "1287" },
                    { model: "11M-1320-12", spec: "120", applicable: "1320" },
                    { model: "11M-1331-12", spec: "121", applicable: "1331" },
                    { model: "11M-1342-12", spec: "122", applicable: "1342" },
                    { model: "11M-1364-12", spec: "124", applicable: "1364" },
                    { model: "11M-1375-12", spec: "125", applicable: "1375" },
                    { model: "11M-1386-12", spec: "126", applicable: "1386" },
                    { model: "11M-1408-12", spec: "128", applicable: "1408" },
                    { model: "11M-1430-12", spec: "130", applicable: "1430" },
                    { model: "11M-1452-12", spec: "132", applicable: "1452" },
                    { model: "11M-1474-12", spec: "134", applicable: "1474" },
                    { model: "11M-1485-12", spec: "135", applicable: "1485" },
                    { model: "11M-1496-12", spec: "136", applicable: "1496" },
                    { model: "11M-1507-12", spec: "137", applicable: "1507" },
                    { model: "11M-1529-12", spec: "139", applicable: "1529" },
                    { model: "11M-1573-12", spec: "143", applicable: "1573" },
                    { model: "11M-1606-12", spec: "146", applicable: "1606" },
                    { model: "11M-1617-12", spec: "147", applicable: "1617" },
                    { model: "11M-1661-12", spec: "151", applicable: "1661" },
                    { model: "11M-1683-12", spec: "153", applicable: "1683" },
                    { model: "11M-1716-12", spec: "156", applicable: "1716" },
                    { model: "11M-1727-12", spec: "157", applicable: "1727" },
                    { model: "11M-1738-12", spec: "158", applicable: "1738" },
                    { model: "11M-1760-12", spec: "160", applicable: "1760" },
                    { model: "11M-1782-12", spec: "162", applicable: "1782" },
                    { model: "11M-1826-12", spec: "166", applicable: "1826" },
                    { model: "11M-1848-12", spec: "168", applicable: "1848" },
                    { model: "11M-1881-12", spec: "171", applicable: "1881" },
                    { model: "11M-1892-12", spec: "172", applicable: "1892" },
                    { model: "11M-1914-12", spec: "174", applicable: "1914" },
                    { model: "11M-1947-12", spec: "177", applicable: "1947" },
                    { model: "11M-1969-12", spec: "179", applicable: "1969" },
                    { model: "11M-1991-12", spec: "181", applicable: "1991" }
                ],
                "10M": [
                    { model: "10M-001", spec: "10速", applicable: "示例数据" },
                    { model: "10M-002", spec: "10速", applicable: "示例数据" },
                    { model: "10M-003", spec: "10速", applicable: "示例数据" },
                    { model: "10M-004", spec: "10速", applicable: "示例数据" },
                    { model: "10M-005", spec: "10速", applicable: "示例数据" }
                ],
                "8M": [
                    { model: "8M-001", spec: "8速", applicable: "示例数据" },
                    { model: "8M-002", spec: "8极", applicable: "示例数据" },
                    { model: "8M-003", spec: "8速", applicable: "示例数据" },
                    { model: "8M-004", spec: "8极", applicable: "示例数据" },
                    { model: "8M-005", spec: "8速", applicable: "示例数据" }
                ]
            },

            // 知识库数据配置 - 更新为皮带驱动系统相关内容
            knowledgeData: [
                {
                    title: "自行车皮带驱动系统如何选型",
                    description: "详细介绍自行车皮带驱动系统的选型原则、参数计算和匹配方法，帮助您选择最适合的皮带系统",
                    link: "https://www.szjiankun.com/15.html",
                    category: "选型指南",
                    icon: "fas fa-cog"
                },
                {
                    title: "皮带系统关于车架设计以及要求",
                    description: "解析皮带驱动系统对自行车车架的特殊要求，包括开口设计、尺寸配合和材料选择等关键技术要点",
                    link: "https://www.szjiankun.com/15.html",
                    category: "车架设计",
                    icon: "fas fa-bicycle"
                },
                {
                    title: "皮带驱动系统的检测与注意事项",
                    description: "掌握皮带驱动系统的日常检测方法、维护要点和使用注意事项，确保系统长期稳定运行",
                    link: "https://www.szjiankun.com/15.html",
                    category: "检测维护",
                    icon: "fas fa-search"
                },
                {
                    title: "皮带驱动系统故障诊断说明",
                    description: "系统介绍皮带驱动系统常见故障现象、诊断方法和解决方案，帮助快速排除问题",
                    link: "https://www.szjiankun.com/15.html",
                    category: "故障诊断",
                    icon: "fas fa-exclamation-triangle"
                },
                {
                    title: "皮带驱动系统工具使用说明",
                    description: "详细说明皮带驱动系统专用工具的正确使用方法、操作步骤和安全注意事项",
                    link: "https://www.szjiankun.com/15.html",
                    category: "工具使用",
                    icon: "fas fa-wrench"
                },
                {
                    title: "皮带驱动系统皮带张紧知多少",
                    description: "深入探讨皮带张紧的重要性、正确张紧方法和张力检测技术，优化传动效率",
                    link: "https://www.szjiankun.com/15.html",
                    category: "张紧技术",
                    icon: "fas fa-compress-alt"
                }
            ],

            /**
             * 获取排序后的工具数据（按ID从大到小）
             */
            getSortedTools: function() {
                return [...this.toolsData].sort((a, b) => b.id - a.id);
            },

            /**
             * 根据分类获取工具数据
             * @param {string} category - 工具分类
             */
            getToolsByCategory: function(category) {
                if (category === 'all') {
                    return this.getSortedTools();
                }
                return this.getSortedTools().filter(tool => tool.category === category);
            },

            /**
             * 根据规格类型获取规格数据
             * @param {string} specType - 规格类型
             */
            getSpecsByType: function(specType) {
                return this.specsData[specType] || [];
            },

            /**
             * 获取所有知识库数据
             */
            getAllKnowledge: function() {
                return this.knowledgeData;
            }
        };

        /**
         * 状态管理模块 - 负责管理应用状态和本地存储
         */
        const StateManager = {
            // 当前应用状态
            currentState: {
                activeTool: null,
                activeCategory: 'all',
                activeSpecTab: '11M',
                carouselIndex: 0,
                currentPage: 'toolsPage',
                // 新增：会话状态，用于临时存储当前会话的状态
                sessionState: {
                    toolDisplayOpen: false,
                    lastToolUrl: null,
                    lastToolTitle: null
                }
            },

            /**
             * 初始化状态（从本地存储恢复）
             */
            init: function() {
                const savedState = localStorage.getItem('bikeToolsState');
                if (savedState) {
                    try {
                        const parsedState = JSON.parse(savedState);
                        // 只恢复持久化状态，不恢复会话状态
                        this.currentState.activeCategory = parsedState.activeCategory || 'all';
                        this.currentState.activeSpecTab = parsedState.activeSpecTab || '11M';
                        this.currentState.carouselIndex = parsedState.carouselIndex || 0;
                        this.currentState.currentPage = parsedState.currentPage || 'toolsPage';
                    } catch (e) {
                        console.error("恢复状态失败:", e);
                    }
                }
                
                // 会话状态总是重置
                this.currentState.sessionState = {
                    toolDisplayOpen: false,
                    lastToolUrl: null,
                    lastToolTitle: null
                };
            },

            /**
             * 更新状态并保存到本地存储
             * @param {object} newState - 新的状态对象
             */
            updateState: function(newState) {
                this.currentState = {...this.currentState, ...newState};
                this.saveState();
            },

            /**
             * 更新会话状态（不保存到本地存储）
             * @param {object} newSessionState - 新的会话状态
             */
            updateSessionState: function(newSessionState) {
                this.currentState.sessionState = {...this.currentState.sessionState, ...newSessionState};
                // 会话状态不保存到本地存储
            },

            /**
             * 保存状态到本地存储（只保存持久化状态）
             */
            saveState: function() {
                try {
                    // 只保存持久化状态，不保存会话状态
                    const persistentState = {
                        activeCategory: this.currentState.activeCategory,
                        activeSpecTab: this.currentState.activeSpecTab,
                        carouselIndex: this.currentState.carouselIndex,
                        currentPage: this.currentState.currentPage
                    };
                    localStorage.setItem('bikeToolsState', JSON.stringify(persistentState));
                } catch (e) {
                    console.error("保存状态失败:", e);
                }
            },

            /**
             * 获取当前状态
             */
            getState: function() {
                return this.currentState;
            },
            
            /**
             * 获取会话状态
             */
            getSessionState: function() {
                return this.currentState.sessionState;
            }
        };

        /**
         * 视图渲染模块 - 负责渲染页面内容
         */
        const ViewRenderer = {
            /**
             * 渲染工具卡片
             * @param {string} category - 工具分类
             */
            renderTools: function(category) {
                const toolGrid = document.getElementById('toolGrid');
                
                // 先显示加载指示器
                toolGrid.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
                
                // 使用Promise确保加载稳定性
                this.loadToolsWithRetry(category, toolGrid, 3); // 最多重试3次
            },

            /**
             * 带重试机制的工具加载
             * @param {string} category - 工具分类
             * @param {HTMLElement} container - 容器元素
             * @param {number} retries - 重试次数
             */
            loadToolsWithRetry: function(category, container, retries) {
                const self = this;
                
                try {
                    setTimeout(() => {
                        try {
                            container.innerHTML = '';
                            
                            const tools = DataManager.getToolsByCategory(category);
                            
                            if (tools.length === 0) {
                                container.innerHTML = '<div class="search-result">暂无工具数据</div>';
                                return;
                            }
                            
                            tools.forEach(tool => {
                                container.appendChild(this.createToolCard(tool));
                            });
                        } catch (error) {
                            console.error("工具加载失败:", error);
                            if (retries > 0) {
                                console.log(`重试加载工具，剩余重试次数: ${retries}`);
                                this.loadToolsWithRetry(category, container, retries - 1);
                            } else {
                                this.showError(container, "工具加载失败，请重试");
                            }
                        }
                    }, 300);
                } catch (error) {
                    console.error("工具加载异常:", error);
                    if (retries > 0) {
                        this.loadToolsWithRetry(category, container, retries - 1);
                    } else {
                        this.showError(container, "工具加载失败，请重试");
                    }
                }
            },

            /**
             * 显示错误信息
             * @param {HTMLElement} container - 容器元素
             * @param {string} message - 错误信息
             */
            showError: function(container, message) {
                container.innerHTML = `
                    <div class="error-message">
                        <p>${message}</p>
                        <button class="retry-button" onclick="window.location.reload()">重试</button>
                    </div>
                `;
            },

            /**
             * 创建工具卡片DOM元素
             * @param {object} tool - 工具数据对象
             */
            createToolCard: function(tool) {
                const card = document.createElement('div');
                card.className = 'tool-card';
                card.setAttribute('data-category', tool.category);
                card.setAttribute('data-link', tool.link);
                card.setAttribute('data-title', tool.title);
                
                // 添加图片加载错误处理
                const imgSrc = tool.image;
                const fallbackSrc = 'https://placehold.co/600x400/718096/white?text=图片加载失败';
                
                card.innerHTML = `
                    <div class="tool-image">
                        <img src="${imgSrc}" alt="${tool.title}" 
                             onerror="this.src='${fallbackSrc}'; this.onerror=null;">
                    </div>
                    <div class="tool-content">
                        <h3 class="tool-title">${tool.title}</h3>
                        <p class="tool-desc">${tool.description}</p>
                    </div>
                `;
                
                return card;
            },

            /**
             * 按分类过滤工具显示
             * @param {string} category - 工具分类
             */
            filterToolsByCategory: function(category) {
                const toolCards = document.querySelectorAll('.tool-card');
                
                toolCards.forEach(card => {
                    if (category === 'all' || card.getAttribute('data-category') === category) {
                        card.style.display = 'flex';
                    } else {
                        card.style.display = 'none';
                    }
                });
            },

            /**
             * 渲染规格表
             * @param {string} specType - 规格类型
             */
            renderSpecs: function(specType) {
                const tbody = document.querySelector('#specsTable tbody');
                
                // 先显示加载指示器
                tbody.innerHTML = '<tr><td colspan="3"><div class="loading"><div class="spinner"></div></div></td></tr>';
                
                // 模拟加载延迟
                setTimeout(() => {
                    try {
                        tbody.innerHTML = '';
                        
                        const specs = DataManager.getSpecsByType(specType);
                        
                        if (specs.length === 0) {
                            tbody.innerHTML = `<tr><td colspan="3" class="search-result">暂无数据</td></tr>`;
                            return;
                        }
                        
                        specs.forEach(spec => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${spec.model}</td>
                                <td>${spec.spec}</td>
                                <td>${spec.applicable}</td>
                            `;
                            tbody.appendChild(row);
                        });
                        
                        // 清空搜索框
                        document.getElementById('specSearchInput').value = '';
                    } catch (error) {
                        console.error("规格表加载失败:", error);
                        tbody.innerHTML = `<tr><td colspan="3" class="error-message">数据加载失败</td></tr>`;
                    }
                }, 300);
            },

            /**
             * 渲染知识库内容 - 优化版
             */
            renderKnowledge: function() {
                const knowledgeGrid = document.getElementById('knowledgeGrid');
                
                // 先显示加载指示器
                knowledgeGrid.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
                
                // 模拟加载延迟
                setTimeout(() => {
                    try {
                        knowledgeGrid.innerHTML = '';
                        
                        const knowledgeItems = DataManager.getAllKnowledge();
                        
                        knowledgeItems.forEach(knowledge => {
                            knowledgeGrid.appendChild(this.createKnowledgeCard(knowledge));
                        });
                    } catch (error) {
                        console.error("知识库加载失败:", error);
                        knowledgeGrid.innerHTML = '<div class="error-message">知识库加载失败</div>';
                    }
                }, 300);
            },

            /**
             * 创建知识库卡片DOM元素 - 优化版（去掉右侧图标）
             * @param {object} knowledge - 知识库数据对象
             */
            createKnowledgeCard: function(knowledge) {
                const card = document.createElement('div');
                card.className = 'knowledge-card';
                card.setAttribute('data-link', knowledge.link);
                card.setAttribute('data-title', knowledge.title);
                
                card.innerHTML = `
                    <div class="knowledge-category">${knowledge.category}</div>
                    <h3 class="knowledge-title">
                        <i class="${knowledge.icon}"></i>
                        ${knowledge.title}
                    </h3>
                    <p class="knowledge-desc">${knowledge.description}</p>
                `;
                
                return card;
            }
        };

        // 其他模块保持不变（CarouselManager, LinkHandler, ToolDisplayManager, HistoryManager, EventBinder）

        /**
         * 轮播图模块 - 负责轮播图功能
         */
        const CarouselManager = {
            currentIndex: 0,
            intervalId: null,

            /**
             * 初始化轮播图
             */
            init: function() {
                this.currentIndex = StateManager.getState().carouselIndex;
                this.updateCarousel();
                this.startAutoPlay();
                this.bindIndicatorEvents();
            },

            /**
             * 更新轮播图显示
             */
            updateCarousel: function() {
                const carouselInner = document.getElementById('carouselInner');
                const indicators = document.querySelectorAll('.carousel-indicator');
                
                carouselInner.style.transform = `translateX(-${this.currentIndex * 100}%)`;
                
                // 更新指示器
                indicators.forEach((indicator, index) => {
                    if (index === this.currentIndex) {
                        indicator.classList.add('active');
                    } else {
                        indicator.classList.remove('active');
                    }
                });
            },

            /**
             * 启动自动轮播
             */
            startAutoPlay: function() {
                this.intervalId = setInterval(() => {
                    this.currentIndex = (this.currentIndex + 1) % 3;
                    this.updateCarousel();
                    StateManager.updateState({carouselIndex: this.currentIndex});
                }, 3000);
            },

            /**
             * 绑定指示器点击事件
             */
            bindIndicatorEvents: function() {
                const indicators = document.querySelectorAll('.carousel-indicator');
                
                indicators.forEach(indicator => {
                    indicator.addEventListener('click', () => {
                        const index = parseInt(indicator.getAttribute('data-index'));
                        this.currentIndex = index;
                        this.updateCarousel();
                        StateManager.updateState({carouselIndex: this.currentIndex});
                        
                        // 重置自动轮播计时器
                        clearInterval(this.intervalId);
                        this.startAutoPlay();
                    });
                });
            }
        };

        /**
         * 链接处理模块 - 负责处理外部链接、PDF和图片链接
         */
        const LinkHandler = {
            currentLink: null,
            currentTitle: null,
            
            /**
             * 初始化链接处理器
             */
            init: function() {
                // 绑定链接处理事件
                document.getElementById('cancelLink').addEventListener('click', this.hide.bind(this));
                document.getElementById('confirmLink').addEventListener('click', this.openLink.bind(this));
                document.getElementById('closePdfPreview').addEventListener('click', this.closePdfPreview.bind(this));
            },
            
            /**
             * 处理链接点击
             * @param {string} url - 链接URL
             * @param {string} title - 链接标题
             */
            handleLink: function(url, title) {
                this.currentLink = url;
                this.currentTitle = title;
                
                // 检查链接类型
                if (this.isPdfLink(url)) {
                    this.openPdfPreview(url, title);
                } else if (this.isImageLink(url)) {
                    this.openImagePreview(url, title);
                } else {
                    this.showExternalLinkWarning(url, title);
                }
            },
            
            /**
             * 检查是否为PDF链接
             * @param {string} url - 链接URL
             */
            isPdfLink: function(url) {
                return url.toLowerCase().endsWith('.pdf');
            },
            
            /**
             * 检查是否为图片链接
             * @param {string} url - 链接URL
             */
            isImageLink: function(url) {
                const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp'];
                return imageExtensions.some(ext => url.toLowerCase().endsWith(ext));
            },
            
            /**
             * 显示外部链接警告
             * @param {string} url - 链接URL
             * @param {string} title - 链接标题
             */
            showExternalLinkWarning: function(url, title) {
                document.getElementById('linkHandlerTitle').textContent = `打开外部链接`;
                document.getElementById('linkHandlerMessage').textContent = 
                    `您即将离开JKaero工具箱访问外部网站：${title}`;
                document.getElementById('linkHandler').style.display = 'flex';
            },
            
            /**
             * 打开PDF预览
             * @param {string} url - PDF链接URL
             * @param {string} title - PDF标题
             */
            openPdfPreview: function(url, title) {
                document.getElementById('pdfTitle').textContent = title;
                document.getElementById('pdfFrame').src = 
                    `https://docs.google.com/gview?url=${encodeURIComponent(url)}&embedded=true`;
                document.getElementById('pdfPreview').style.display = 'flex';
                document.body.style.overflow = 'hidden';
            },
            
            /**
             * 打开图片预览
             * @param {string} url - 图片链接URL
             * @param {string} title - 图片标题
             */
            openImagePreview: function(url, title) {
                // 可以扩展为全屏图片查看器
                window.open(url, '_blank');
            },
            
            /**
             * 打开链接（用户确认后）
             */
            openLink: function() {
                if (this.currentLink) {
                    window.open(this.currentLink, '_blank');
                }
                this.hide();
            },
            
            /**
             * 关闭PDF预览
             */
            closePdfPreview: function() {
                document.getElementById('pdfPreview').style.display = 'none';
                document.getElementById('pdfFrame').src = '';
                document.body.style.overflow = 'auto';
            },
            
            /**
             * 隐藏链接处理器
             */
            hide: function() {
                document.getElementById('linkHandler').style.display = 'none';
                this.currentLink = null;
                this.currentTitle = null;
            }
        };

        /**
         * 工具展示模块 - 负责工具iframe展示功能
         */
        const ToolDisplayManager = {
            /**
             * 打开工具展示
             * @param {string} url - 工具URL
             * @param {string} title - 工具标题
             */
            openToolDisplay: function(url, title) {
                document.title = title; // 修改页面标题
                document.getElementById('toolFrame').src = url;
                document.getElementById('toolDisplay').style.display = 'flex';
                document.getElementById('closeTool').style.display = 'flex';
                document.body.classList.add('no-scroll');
                
                // 更新会话状态（不持久化）
                StateManager.updateSessionState({
                    toolDisplayOpen: true,
                    lastToolUrl: url,
                    lastToolTitle: title
                });
                
                // 如果是微信浏览器，保存状态
                if (WechatHelper.isWechatBrowser()) {
                    WechatHelper.savePageState();
                }
            },
            
            /**
             * 关闭工具展示
             */
            closeToolDisplay: function() {
                document.getElementById('toolDisplay').style.display = 'none';
                document.getElementById('toolFrame').src = 'about:blank';
                document.getElementById('closeTool').style.display = 'none';
                document.title = "JKaero工具箱|自行车工程工具集"; // 恢复页面标题
                document.body.classList.remove('no-scroll');
                
                // 更新会话状态
                StateManager.updateSessionState({
                    toolDisplayOpen: false,
                    lastToolUrl: null,
                    lastToolTitle: null
                });
                
                // 如果是微信浏览器，保存状态
                if (WechatHelper.isWechatBrowser()) {
                    WechatHelper.savePageState();
                }
            },
            
            /**
             * 检查是否应该恢复工具显示
             */
            shouldRestoreToolDisplay: function() {
                const sessionState = StateManager.getSessionState();
                return sessionState.toolDisplayOpen && sessionState.lastToolUrl;
            },
            
            /**
             * 恢复工具显示（如果应该恢复的话）
             */
            restoreToolDisplayIfNeeded: function() {
                if (this.shouldRestoreToolDisplay()) {
                    const sessionState = StateManager.getSessionState();
                    this.openToolDisplay(sessionState.lastToolUrl, sessionState.lastToolTitle);
                }
            }
        };

        /**
         * 页面历史管理模块 - 修复滑动返回问题
         */
        const HistoryManager = {
            /**
             * 初始化历史管理
             */
            init: function() {
                // 监听popstate事件（浏览器前进/后退）
                window.addEventListener('popstate', this.handlePopState.bind(this));
                
                // 初始状态
                if (!history.state) {
                    history.replaceState({ page: 'toolsPage' }, '', '#toolsPage');
                }
            },
            
            /**
             * 处理浏览器前进/后退事件
             * @param {Event} event - popstate事件
             */
            handlePopState: function(event) {
                if (event.state && event.state.page) {
                    this.switchToPage(event.state.page, false);
                }
            },
            
            /**
             * 切换页面并更新历史记录
             * @param {string} pageId - 页面ID
             * @param {boolean} pushState - 是否推送新状态到历史记录
             */
            switchToPage: function(pageId, pushState = true) {
                const pages = document.querySelectorAll('.page');
                const navItems = document.querySelectorAll('.nav-item');
                
                // 隐藏所有页面
                pages.forEach(page => {
                    page.classList.remove('active');
                });
                
                // 显示目标页面
                const targetPage = document.getElementById(pageId);
                if (targetPage) {
                    setTimeout(() => {
                        targetPage.classList.add('active');
                    }, 50);
                }
                
                // 更新导航项状态
                navItems.forEach(item => {
                    if (item.getAttribute('data-page') === pageId) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
                
                // 更新状态
                StateManager.updateState({currentPage: pageId});
                
                // 如果是切换到工具页面，检查是否需要恢复工具显示
                if (pageId === 'toolsPage') {
                    // 短暂延迟确保页面切换完成
                    setTimeout(() => {
                        ToolDisplayManager.restoreToolDisplayIfNeeded();
                    }, 100);
                }
                
                // 推送新状态到历史记录
                if (pushState) {
                    history.pushState({ page: pageId }, '', `#${pageId}`);
                }
                
                // 如果是微信浏览器，保存状态
                if (WechatHelper.isWechatBrowser()) {
                    WechatHelper.savePageState();
                }
            },
            
            /**
             * 获取当前页面ID
             */
            getCurrentPage: function() {
                return StateManager.getState().currentPage;
            }
        };

        /**
         * 事件绑定模块 - 负责绑定所有事件监听器
         */
        const EventBinder = {
            /**
             * 初始化所有事件绑定
             */
            init: function() {
                this.bindNavigationEvents();
                this.bindToolEvents();
                this.bindSpecsEvents();
                this.bindKnowledgeEvents();
                this.bindGlobalEvents();
            },
            
            /**
             * 绑定导航相关事件
             */
            bindNavigationEvents: function() {
                const navItems = document.querySelectorAll('.nav-item');
                
                navItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        
                        const targetPage = item.getAttribute('data-page');
                        
                        // 如果工具页面打开，先关闭工具
                        if (document.getElementById('toolDisplay').style.display === 'flex') {
                            ToolDisplayManager.closeToolDisplay();
                            setTimeout(() => HistoryManager.switchToPage(targetPage), 100);
                        } else {
                            // 直接切换页面
                            HistoryManager.switchToPage(targetPage);
                        }
                    });
                });
            },
            
            /**
             * 绑定工具相关事件
             */
            bindToolEvents: function() {
                // 工具分类过滤
                const categoryButtons = document.querySelectorAll('.category-btn');
                
                // 设置当前激活的分类
                const currentCategory = StateManager.getState().activeCategory;
                const activeCategoryBtn = document.querySelector(`.category-btn[data-category="${currentCategory}"]`);
                if (activeCategoryBtn) {
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    activeCategoryBtn.classList.add('active');
                }
                
                categoryButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        // 移除所有按钮的active类
                        categoryButtons.forEach(btn => btn.classList.remove('active'));
                        // 为当前点击的按钮添加active类
                        this.classList.add('active');
                        
                        const category = this.getAttribute('data-category');
                        StateManager.updateState({activeCategory: category});
                        
                        // 重新渲染工具
                        ViewRenderer.renderTools(category);
                        
                        // 如果是微信浏览器，保存状态
                        if (WechatHelper.isWechatBrowser()) {
                            WechatHelper.savePageState();
                        }
                    });
                });
                
                // 工具卡片点击事件
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.tool-card')) {
                        const card = e.target.closest('.tool-card');
                        const toolLink = card.getAttribute('data-link');
                        const toolTitle = card.getAttribute('data-title');
                        
                        ToolDisplayManager.openToolDisplay(toolLink, toolTitle);
                    }
                });
            },
            
            /**
             * 绑定规格表相关事件
             */
            bindSpecsEvents: function() {
                // 规格表切换
                const specsTabs = document.querySelectorAll('.specs-tab');
                
                // 设置当前激活的规格标签
                const currentSpecTab = StateManager.getState().activeSpecTab;
                const activeSpecTab = document.querySelector(`.specs-tab[data-spec="${currentSpecTab}"]`);
                if (activeSpecTab) {
                    specsTabs.forEach(t => t.classList.remove('active'));
                    activeSpecTab.classList.add('active');
                }
                
                specsTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        // 移除所有标签的active类
                        specsTabs.forEach(t => t.classList.remove('active'));
                        // 为当前点击的标签添加active类
                        this.classList.add('active');
                        
                        const specType = this.getAttribute('data-spec');
                        StateManager.updateState({activeSpecTab: specType});
                        
                        // 渲染对应规格表
                        ViewRenderer.renderSpecs(specType);
                        
                        // 如果是微信浏览器，保存状态
                        if (WechatHelper.isWechatBrowser()) {
                            WechatHelper.savePageState();
                        }
                    });
                });
                
                // 规格搜索功能
                const specSearchBtn = document.getElementById('specSearchBtn');
                const specSearchInput = document.getElementById('specSearchInput');
                
                // 修复搜索按钮事件绑定
                specSearchBtn.addEventListener('click', () => {
                    this.performSpecSearch();
                });
                
                specSearchInput.addEventListener('keyup', (event) => {
                    if (event.key === 'Enter') {
                        this.performSpecSearch();
                    }
                });
                
                // 搜索函数
                this.performSpecSearch = function() {
                    const searchTerm = specSearchInput.value.trim().toLowerCase();
                    const activeTab = document.querySelector('.specs-tab.active').getAttribute('data-spec');
                    const tableRows = document.querySelectorAll('#specsTable tbody tr');
                    
                    // 检查是否有数据行（排除加载指示器和无数据提示）
                    const hasDataRows = tableRows.length > 0 && 
                                       !tableRows[0].querySelector('.loading') && 
                                       !tableRows[0].classList.contains('search-result');
                    
                    if (!hasDataRows) {
                        // 如果没有数据行，重新渲染当前规格表
                        ViewRenderer.renderSpecs(activeTab);
                        return;
                    }
                    
                    if (searchTerm === '') {
                        // 如果搜索为空，重新渲染当前规格表
                        ViewRenderer.renderSpecs(activeTab);
                        return;
                    }
                    
                    let found = false;
                    
                    tableRows.forEach(row => {
                        // 跳过非数据行
                        if (row.querySelector('.loading') || row.classList.contains('search-result')) {
                            return;
                        }
                        
                        const model = row.cells[0].textContent.toLowerCase();
                        const spec = row.cells[1].textContent.toLowerCase();
                        const applicable = row.cells[2].textContent.toLowerCase();
                        
                        if (model.includes(searchTerm) || spec.includes(searchTerm) || applicable.includes(searchTerm)) {
                            row.style.display = '';
                            found = true;
                        } else {
                            row.style.display = 'none';
                        }
                    });
                    
                    // 显示搜索结果提示
                    if (!found) {
                        const tbody = document.querySelector('#specsTable tbody');
                        // 先隐藏所有行
                        tableRows.forEach(row => {
                            row.style.display = 'none';
                        });
                        // 添加搜索结果提示
                        const noResultRow = document.createElement('tr');
                        noResultRow.innerHTML = `<td colspan="3" class="search-result">未找到匹配的规格</td>`;
                        tbody.appendChild(noResultRow);
                    }
                };
            },
            
            /**
             * 绑定知识库相关事件
             */
            bindKnowledgeEvents: function() {
                // 知识卡片点击事件
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.knowledge-card')) {
                        e.preventDefault();
                        const card = e.target.closest('.knowledge-card');
                        const knowledgeLink = card.getAttribute('data-link');
                        const knowledgeTitle = card.getAttribute('data-title');
                        
                        LinkHandler.handleLink(knowledgeLink, knowledgeTitle);
                    }
                });
            },
            
            /**
             * 绑定全局事件
             */
            bindGlobalEvents: function() {
                // 关闭工具按钮
                document.getElementById('closeTool').addEventListener('click', ToolDisplayManager.closeToolDisplay);
                
                // ESC键关闭工具
                document.addEventListener('keydown', (event) => {
                    if (event.key === 'Escape' && document.getElementById('toolDisplay').style.display === 'flex') {
                        ToolDisplayManager.closeToolDisplay();
                    }
                });
                
                // 防止页面滚动穿透
                document.addEventListener('touchmove', function(e) {
                    if (document.body.classList.contains('no-scroll')) {
                        e.preventDefault();
                    }
                }, { passive: false });
            }
        };

        /**
         * 主应用初始化函数
         */
        function initApp() {
            console.log("DOM内容已加载，开始初始化...");
            
            // 初始化状态管理器
            StateManager.init();
            
            // 初始化微信浏览器处理
            WechatHelper.init();
            
            // 初始化各模块
            HistoryManager.init();
            CarouselManager.init();
            LinkHandler.init();
            EventBinder.init();
            
            // 根据URL hash设置初始页面
            const hash = window.location.hash.replace('#', '');
            const initialPage = hash || 'toolsPage';
            HistoryManager.switchToPage(initialPage, false);
            
            // 渲染初始内容
            ViewRenderer.renderTools(StateManager.getState().activeCategory);
            ViewRenderer.renderSpecs(StateManager.getState().activeSpecTab);
            ViewRenderer.renderKnowledge();
            
            console.log("初始化完成！");
        }

        // 当DOM内容加载完成后初始化应用
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>