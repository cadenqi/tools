<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>齿盘参数计算器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c7da0;
            --primary-light: #61a5c2;
            --secondary: #ff9e00;
            --accent: #a61f2b;
            --light: #f8f9fa;
            --dark: #2d3e50;
            --success: #43aa8b;
            --card-bg: #ffffff;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            --gradient: linear-gradient(135deg, #2c7da0 0%, #1a4c6f 100%);
            --bg-color: #f0f4f8;
            --sprocket-color: #ff9e00;
            --nav-height: 50px;
            --header-height: 70px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--dark);
            min-height: 100vh;
            padding: 0;
            position: relative;
            overflow-x: hidden;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .background-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 5% 10%, rgba(44, 125, 160, 0.03) 15px, transparent 30px),
                radial-gradient(circle at 95% 80%, rgba(255, 158, 0, 0.03) 15px, transparent 30px);
            z-index: -1;
        }
        
        /* 页面容器 */
        .container {
            max-width: 100%;
            padding: 0 12px;
            margin: 0 auto;
        }
        
        /* 标题区域 */
        .header {
            text-align: center;
            padding: 12px 0 8px;
            height: var(--header-height);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary);
        }
        
        .logo i {
            margin-right: 8px;
            font-size: 1.3rem;
        }
        
        /* 导航栏 */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            padding: 4px;
            box-shadow: var(--shadow);
            margin-bottom: 15px;
            position: sticky;
            top: 10px;
            z-index: 100;
        }
        
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 10px 5px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .nav-item.active {
            background: var(--gradient);
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        /* 内容区域 */
        .content-area {
            height: calc(100vh - var(--header-height) - 70px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 20px;
        }
        
        /* 页面部分 */
        .page {
            display: none;
            width: 100%;
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        /* 计算器页面 */
        .calculator-card {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 18px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .calculator-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--sprocket-color);
        }
        
        .input-section {
            margin-bottom: 18px;
        }
        
        .section-title {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title i {
            color: var(--sprocket-color);
            font-size: 1rem;
        }
        
        .input-group {
            margin-bottom: 12px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1.5px solid #e0e6ed;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s;
        }
        
        .input-group input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(44, 125, 160, 0.15);
        }
        
        .pitch-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .pitch-btn {
            background: white;
            border: 1.5px solid #e0e6ed;
            border-radius: 8px;
            padding: 10px 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.85rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .pitch-btn.active {
            background: var(--sprocket-color);
            border-color: var(--sprocket-color);
            color: white;
        }
        
        .pitch-btn .pitch-value {
            font-size: 0.95rem;
            font-weight: 700;
            margin-bottom: 3px;
        }
        
        .pitch-btn .pitch-label {
            font-size: 0.75rem;
            opacity: 0.9;
        }
        
        .custom-pitch-container {
            margin-top: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }
        
        .calculate-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 13px 16px;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            width: 100%;
            background: var(--sprocket-color);
            color: white;
            margin-top: 8px;
        }
        
        .calculate-btn:hover {
            background: #e58e00;
            box-shadow: 0 3px 6px rgba(255, 158, 0, 0.25);
        }
        
        .result-section {
            margin-top: 18px;
        }
        
        .result-title {
            font-size: 1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--sprocket-color);
        }
        
        .result-box {
            background: #f8fafc;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #eaeef2;
        }
        
        .result-item {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .result-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
        }
        
        .result-label i {
            color: var(--sprocket-color);
            font-size: 0.85rem;
        }
        
        .result-value {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--sprocket-color);
        }
        
        .note {
            margin-top: 12px;
            font-size: 0.8rem;
            color: #5a6a7e;
            background: #fffaf0;
            padding: 10px 12px;
            border-radius: 6px;
            border-left: 2px solid var(--secondary);
            line-height: 1.5;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }
        
        .copy-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 10px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            width: 100%;
            background: var(--success);
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .copy-btn.copied {
            background: #379c80;
        }
        
        .copy-btn.copied::after {
            content: '✓ 已复制';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--success);
        }
        
        .copy-btn:hover {
            background: #379c80;
            box-shadow: 0 3px 6px rgba(67, 170, 139, 0.25);
        }
        
        /* 计算记录页面 */
        .history-section {
            margin-top: 8px;
        }
        
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .history-item {
            background: white;
            border-radius: 10px;
            padding: 14px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-info {
            flex: 1;
            overflow: hidden;
        }
        
        .history-type {
            font-weight: 700;
            font-size: 0.95rem;
            margin-bottom: 4px;
            color: var(--sprocket-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .history-details {
            font-size: 0.82rem;
            color: #5a6a7e;
            margin-bottom: 4px;
            line-height: 1.4;
        }
        
        .history-date {
            font-size: 0.75rem;
            color: #8a8a8a;
        }
        
        .history-actions {
            display: flex;
            gap: 6px;
        }
        
        .history-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f4f8;
            border: none;
            color: var(--primary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .history-btn.copied {
            background: var(--success);
            color: white;
        }
        
        .history-btn.copied i {
            opacity: 0;
        }
        
        .history-btn.copied::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1rem;
            font-weight: bold;
        }
        
        .history-btn:hover {
            background: var(--primary-light);
            color: white;
        }
        
        .empty-state {
            text-align: center;
            padding: 30px 15px;
            color: #8a8a8a;
        }
        
        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 12px;
            color: #e0e6ed;
        }
        
        .empty-state p {
            margin-bottom: 6px;
            font-size: 0.9rem;
        }
        
        .clear-history {
            display: block;
            width: 100%;
            padding: 12px;
            background: #f8f9fa;
            border: 1.5px solid #e0e6ed;
            border-radius: 8px;
            color: #5a6a7e;
            font-weight: 600;
            margin-top: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .clear-history:hover {
            background: #fff;
            border-color: var(--accent);
            color: var(--accent);
        }
        
        /* 使用说明页面 */
        .instructions-section {
            margin-top: 8px;
        }
        
        .instruction-card {
            background: white;
            border-radius: 14px;
            padding: 18px;
            box-shadow: var(--shadow);
            margin-bottom: 12px;
        }
        
        .instruction-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .instruction-content {
            color: #5a6a7e;
            line-height: 1.5;
            font-size: 0.9rem;
        }
        
        .instruction-content ol, .instruction-content ul {
            padding-left: 18px;
            margin: 10px 0;
        }
        
        .instruction-content li {
            margin-bottom: 6px;
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .calculator-card, .history-item, .instruction-card {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* 响应式调整 */
        @media (min-width: 480px) {
            .container {
                max-width: 480px;
                padding: 0 15px;
            }
            
            .pitch-btn {
                padding: 10px 8px;
            }
        }
        
        @media (min-width: 768px) {
            .container {
                max-width: 600px;
            }
            
            .nav-item {
                padding: 10px 8px;
                font-size: 0.92rem;
            }
            
            .calculator-card {
                padding: 20px;
            }
        }
        
        @media (max-width: 350px) {
            .pitch-selector {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .pitch-btn .pitch-value {
                font-size: 0.9rem;
            }
            
            .pitch-btn .pitch-label {
                font-size: 0.7rem;
            }
            
            .history-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .history-actions {
                align-self: flex-end;
            }
            
            body {
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="background-pattern"></div>
    
    <div class="container">
        <!-- 标题区域 -->
        <div class="header">
            <div class="logo">
                <i class="fas fa-cog"></i>
                <span>齿盘参数计算器</span>
            </div>
        </div>
        
        <!-- 导航栏 -->
        <div class="nav-tabs">
            <div class="nav-item active" data-page="calculator-page">计算</div>
            <div class="nav-item" data-page="history-page">记录</div>
            <div class="nav-item" data-page="instructions-page">说明</div>
        </div>
        
        <!-- 内容区域 -->
        <div class="content-area">
            <!-- 计算器页面 -->
            <div class="page active" id="calculator-page">
                <div class="calculator-card">
                    <div class="input-section">
                        <h3 class="section-title"><i class="fas fa-sliders-h"></i> 参数设置</h3>
                        
                        <div class="pitch-selector">
                            <div class="pitch-btn active" data-pitch="12.7">
                                <span class="pitch-value">12.7</span>
                                <span class="pitch-label">常用</span>
                            </div>
                            <div class="pitch-btn" id="customBtn">
                                <span class="pitch-value">自定义</span>
                                <span class="pitch-label">其他尺寸</span>
                            </div>
                        </div>
                        
                        <div class="custom-pitch-container" id="customPitchContainer">
                            <div class="input-group">
                                <label><i class="fas fa-ruler"></i> 齿盘节距 (mm)</label>
                                <input type="number" id="sprocketPitch" placeholder="输入齿盘节距" min="1" step="0.1" value="12.7">
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label><i class="fas fa-cog"></i> 齿盘齿数 (T)</label>
                            <input type="number" id="sprocketTeeth" placeholder="输入齿数" min="1" max="1000" value="20">
                        </div>
                        
                        <button class="calculate-btn" id="calculateBtn">
                            <i class="fas fa-calculator"></i>
                            计算参数
                        </button>
                    </div>
                    
                    <div class="result-section">
                        <h3 class="result-title"><i class="fas fa-chart-line"></i> 计算结果</h3>
                        
                        <div class="result-box">
                            <div class="result-item">
                                <span class="result-label"><i class="fas fa-circle"></i> 节圆直径≈</span>
                                <span class="result-value" id="sprocketPCD">--</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label"><i class="fas fa-arrows-alt-h"></i> 齿盘外径≈</span>
                                <span class="result-value" id="sprocketOD">--</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label"><i class="fas fa-ruler-combined"></i> 齿盘内径≈</span>
                                <span class="result-value" id="sprocketID">--</span>
                            </div>
                            <div class="note" id="sprocketNote">
                                输入齿数后点击计算按钮
                            </div>
                            
                            <div class="action-buttons">
                                <button class="copy-btn" id="copyBtn">
                                    <i class="fas fa-copy"></i>
                                    复制结果
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 计算记录页面 -->
            <div class="page" id="history-page">
                <div class="history-section">
                    <div class="history-list" id="historyList">
                        <!-- 历史记录将通过JS动态添加 -->
                    </div>
                    
                    <div class="empty-state" id="emptyHistory">
                        <i class="fas fa-inbox"></i>
                        <p>暂无计算记录</p>
                        <p>开始使用计算器，您的记录将显示在这里</p>
                    </div>
                    
                    <button class="clear-history" id="clearHistoryBtn">
                        <i class="fas fa-trash"></i> 清空所有记录
                    </button>
                </div>
            </div>
            
            <!-- 使用说明页面 -->
            <div class="page" id="instructions-page">
                <div class="instructions-section">
                    <div class="instruction-card">
                        <h3 class="instruction-title"><i class="fas fa-calculator"></i> 计算器使用指南</h3>
                        <div class="instruction-content">
                            <p>本工具提供齿盘参数的专业计算功能：</p>
                            <ol>
                                <li>选择或输入齿盘的节距（12.7mm或自定义）</li>
                                <li>输入齿数（1-1000之间的整数）</li>
                                <li>点击"计算"按钮获取精确参数</li>
                                <li>计算结果会自动保存到历史记录</li>
                            </ol>
                        </div>
                    </div>
                    
                    <div class="instruction-card">
                        <h3 class="instruction-title"><i class="fas fa-ruler"></i> 参数说明</h3>
                        <div class="instruction-content">
                            <ul>
                                <li><strong>节距</strong>：相邻两齿中心之间的距离</li>
                                <li><strong>节圆直径</strong>：理论啮合圆的直径，计算公式为：节距 / sin(π/齿数)</li>
                                <li><strong>齿盘外径</strong>：齿顶圆的直径，计算公式为：节圆直径 + 0.6 * 节距</li>
                                <li><strong>齿盘内径</strong>：齿根圆的直径，计算公式为：节圆直径 - 0.8 * 节距</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="instruction-card">
                        <h3 class="instruction-title"><i class="fas fa-lightbulb"></i> 使用技巧</h3>
                        <div class="instruction-content">
                            <ul>
                                <li>常用齿盘节距：12.7mm</li>
                                <li>计算结果仅供参考，实际应用需考虑材料和工艺因素</li>
                                <li>历史记录功能可帮助您比较不同配置</li>
                                <li>使用复制功能可以方便地分享计算结果</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 获取页面元素
            // 页面切换元素
            const navItems = document.querySelectorAll('.nav-item');
            const pages = document.querySelectorAll('.page');
            
            // 齿盘相关元素
            const pitchButtons = document.querySelectorAll('.pitch-btn');
            const customBtn = document.getElementById('customBtn');
            const customPitchContainer = document.getElementById('customPitchContainer');
            const sprocketPitchInput = document.getElementById('sprocketPitch');
            const sprocketTeethInput = document.getElementById('sprocketTeeth');
            const calculateBtn = document.getElementById('calculateBtn');
            const sprocketPCD = document.getElementById('sprocketPCD');
            const sprocketOD = document.getElementById('sprocketOD');
            const sprocketID = document.getElementById('sprocketID');
            const sprocketNote = document.getElementById('sprocketNote');
            const copyBtn = document.getElementById('copyBtn');
            
            // 历史记录相关元素
            const historyList = document.getElementById('historyList');
            const emptyHistory = document.getElementById('emptyHistory');
            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            
            // 当前选择的参数
            let currentPitch = 12.7; // 默认选择12.7mm
            let isCustomPitch = false; // 是否使用自定义节距
            
            // 初始化
            init();
            
            // 初始化函数
            function init() {
                // 设置页面切换事件
                setupPageNavigation();
                
                // 设置齿盘事件
                setupSprocketEvents();
                
                // 设置历史记录事件
                setupHistoryEvents();
                
                // 加载历史记录
                loadHistory();
            }
            
            // 设置页面导航
            function setupPageNavigation() {
                navItems.forEach(nav => {
                    nav.addEventListener('click', function() {
                        const pageId = this.getAttribute('data-page');
                        
                        // 更新激活的导航项
                        navItems.forEach(item => item.classList.remove('active'));
                        this.classList.add('active');
                        
                        // 显示对应的页面
                        pages.forEach(page => page.classList.remove('active'));
                        document.getElementById(pageId).classList.add('active');
                    });
                });
            }
            
            // 设置齿盘事件
            function setupSprocketEvents() {
                // 节距按钮点击事件
                pitchButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        // 移除所有按钮的active类
                        pitchButtons.forEach(b => b.classList.remove('active'));
                        // 给当前点击的按钮添加active类
                        this.classList.add('active');
                        
                        // 检查是否点击了自定义按钮
                        if (this.id === 'customBtn') {
                            isCustomPitch = true;
                            customPitchContainer.style.display = 'block';
                        } else {
                            isCustomPitch = false;
                            customPitchContainer.style.display = 'none';
                            // 更新当前选择的节距
                            currentPitch = parseFloat(this.getAttribute('data-pitch'));
                        }
                    });
                });
                
                // 计算按钮点击事件
                calculateBtn.addEventListener('click', function() {
                    calculateSprocket();
                });
                
                // 复制按钮点击事件
                copyBtn.addEventListener('click', function() {
                    copySprocketResult();
                });
                
                // 输入框回车键计算
                sprocketTeethInput.addEventListener('keyup', function(event) {
                    if (event.key === 'Enter') {
                        calculateSprocket();
                    }
                });
            }
            
            // 设置历史记录事件
            function setupHistoryEvents() {
                // 清空历史记录按钮
                clearHistoryBtn.addEventListener('click', function() {
                    if (confirm('确定要清空所有历史记录吗？')) {
                        clearHistory();
                    }
                });
            }
            
            // 计算节圆直径
            function calculatePCD(teeth, pitch) {
                return pitch / Math.sin(Math.PI / teeth);
            }
            
            // 计算齿盘外径
            function calculateSprocketOD(pcd, pitch) {
                // 齿盘外径 = 节圆直径 + 0.6 * 节距
                return pcd + (0.6 * pitch);
            }
            
            // 计算齿盘内径
            function calculateSprocketID(pcd, pitch) {
                // 齿盘内径 = 节圆直径 - 0.8 * 节距
                return pcd - (0.8 * pitch);
            }
            
            // 计算齿盘参数
            function calculateSprocket() {
                const teeth = parseInt(sprocketTeethInput.value);
                
                // 获取节距值
                let pitch;
                
                if (isCustomPitch) {
                    pitch = parseFloat(sprocketPitchInput.value);
                    
                    // 验证自定义节距输入
                    if (isNaN(pitch) || pitch <= 0) {
                        sprocketNote.textContent = '请输入有效的节距值';
                        return;
                    }
                } else {
                    pitch = currentPitch;
                }
                
                // 验证输入是否有效
                if (isNaN(teeth) || teeth <= 0) {
                    sprocketPCD.textContent = '--';
                    sprocketOD.textContent = '--';
                    sprocketID.textContent = '--';
                    sprocketNote.textContent = '请输入有效的齿数';
                    return;
                }
                
                // 计算节圆直径
                const pcd = calculatePCD(teeth, pitch);
                
                // 计算齿盘外径
                const od = calculateSprocketOD(pcd, pitch);
                
                // 计算齿盘内径
                const id = calculateSprocketID(pcd, pitch);
                
                // 更新UI显示结果
                sprocketPCD.textContent = `${pcd.toFixed(2)}mm`;
                sprocketOD.textContent = `${od.toFixed(2)}mm`;
                sprocketID.textContent = `${id.toFixed(2)}mm`;
                
                sprocketNote.innerHTML = `基于${pitch}mm节距计算`;
                
                // 存储结果用于复制
                const result = {
                    teeth: teeth,
                    pitch: pitch,
                    pcd: pcd,
                    od: od,
                    id: id,
                    type: 'sprocket'
                };
                
                window.sprocketResult = result;
                
                // 自动保存到历史记录
                saveToHistory(result);
            }
            
            // 复制齿盘计算结果
            function copySprocketResult() {
                if (!window.sprocketResult) {
                    alert('请先进行计算');
                    return;
                }
                
                const result = window.sprocketResult;
                const copyText = `${result.pitch}mm齿盘${result.teeth}T：节圆直径≈${result.pcd.toFixed(2)}mm，外径≈${result.od.toFixed(2)}mm，内径≈${result.id.toFixed(2)}mm`;
                
                copyToClipboard(copyText, copyBtn);
            }
            
            // 复制到剪贴板函数
            function copyToClipboard(text, buttonElement) {
                // 兼容手机端的复制方法
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.top = 0;
                textArea.style.left = 0;
                textArea.style.width = '2em';
                textArea.style.height = '2em';
                textArea.style.padding = 0;
                textArea.style.border = 'none';
                textArea.style.outline = 'none';
                textArea.style.boxShadow = 'none';
                textArea.style.background = 'transparent';
                
                document.body.appendChild(textArea);
                textArea.select();
                
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        // 显示复制成功反馈
                        showCopyFeedback(buttonElement);
                    } else {
                        alert('复制失败，请手动复制结果');
                    }
                } catch (err) {
                    alert('复制失败，请手动复制结果');
                }
                
                document.body.removeChild(textArea);
            }
            
            // 显示复制成功反馈
            function showCopyFeedback(buttonElement) {
                // 添加复制成功样式
                buttonElement.classList.add('copied');
                
                // 2秒后恢复原状
                setTimeout(function() {
                    buttonElement.classList.remove('copied');
                }, 2000);
            }
            
            // 保存到历史记录
            function saveToHistory(result) {
                // 获取现有历史记录
                let history = JSON.parse(localStorage.getItem('sprocketHistory') || '[]');
                
                // 添加时间戳
                result.timestamp = new Date().toISOString();
                result.date = new Date().toLocaleString();
                
                // 添加到历史记录
                history.unshift(result);
                
                // 限制历史记录数量（最多20条）
                if (history.length > 20) {
                    history = history.slice(0, 20);
                }
                
                // 保存到本地存储
                localStorage.setItem('sprocketHistory', JSON.stringify(history));
                
                // 刷新历史记录显示
                loadHistory();
            }
            
            // 加载历史记录
            function loadHistory() {
                const history = JSON.parse(localStorage.getItem('sprocketHistory') || '[]');
                
                // 清空现有显示
                historyList.innerHTML = '';
                
                if (history.length === 0) {
                    emptyHistory.style.display = 'block';
                    return;
                }
                
                emptyHistory.style.display = 'none';
                
                // 添加历史记录项
                history.forEach((item, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    
                    const typeText = `${item.pitch}mm齿盘 ${item.teeth}T`;
                    const detailsText = `节圆直径: ${item.pcd.toFixed(2)}mm, 外径: ${item.od.toFixed(2)}mm, 内径: ${item.id.toFixed(2)}mm`;
                    
                    historyItem.innerHTML = `
                        <div class="history-info">
                            <div class="history-type">${typeText}</div>
                            <div class="history-details">${detailsText}</div>
                            <div class="history-date">${item.date}</div>
                        </div>
                        <div class="history-actions">
                            <button class="history-btn" data-index="${index}">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="history-btn" data-index="${index}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    historyList.appendChild(historyItem);
                });
                
                // 添加历史记录项的事件
                document.querySelectorAll('.history-actions .history-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        const history = JSON.parse(localStorage.getItem('sprocketHistory') || '[]');
                        
                        if (this.querySelector('.fa-copy')) {
                            // 复制操作
                            copyHistoryItem(history[index], this);
                        } else if (this.querySelector('.fa-trash')) {
                            // 删除操作
                            deleteHistoryItem(index);
                        }
                    });
                });
            }
            
            // 复制历史记录项
            function copyHistoryItem(item, buttonElement) {
                const copyText = `${item.pitch}mm齿盘${item.teeth}T：节圆直径≈${item.pcd.toFixed(2)}mm，外径≈${item.od.toFixed(2)}mm，内径≈${item.id.toFixed(2)}mm`;
                copyToClipboard(copyText, buttonElement);
            }
            
            // 删除历史记录项
            function deleteHistoryItem(index) {
                let history = JSON.parse(localStorage.getItem('sprocketHistory') || '[]');
                
                if (index >= 0 && index < history.length) {
                    history.splice(index, 1);
                    localStorage.setItem('sprocketHistory', JSON.stringify(history));
                    loadHistory();
                }
            }
            
            // 清空历史记录
            function clearHistory() {
                localStorage.removeItem('sprocketHistory');
                loadHistory();
            }
        });
    </script>
</body>
</html>