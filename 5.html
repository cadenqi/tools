<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自行车驱动系统换算工具</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #ff7043;
            --primary-dark: #e64a19;
            --primary-light: #ff9d7d;
            --secondary: #5c6bc0;
            --accent: #ffab40;
            --light: #fff3e0;
            --dark: #4e342e;
            --gray: #8d6e63;
            --light-gray: #f5f5f5;
            --success: #66bb6a;
            --warning: #ffa726;
            --danger: #ef5350;
            --card-bg: #ffffff;
            --shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            --border-radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: #fff8f1;
            color: var(--dark);
            line-height: 1.5;
            padding-bottom: 15px;
            min-height: 100vh;
            font-size: 14px;
        }
        
        .container {
            max-width: 100%;
            padding: 0 10px;
            margin: 0 auto;
        }
        
        .app-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 15px 10px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        
        .app-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 3px;
        }
        
        .app-subtitle {
            font-size: 0.75rem;
            opacity: 0.9;
        }
        
        .top-nav {
            display: flex;
            justify-content: space-around;
            background: white;
            padding: 10px 0;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 6px;
            transition: all 0.3s;
            font-size: 0.75rem;
            min-width: 60px;
        }
        
        .nav-item.active {
            background: rgba(255, 112, 67, 0.12);
        }
        
        .nav-icon {
            font-size: 0.9rem;
            margin-bottom: 3px;
            color: var(--gray);
        }
        
        .nav-item.active .nav-icon {
            color: var(--primary);
        }
        
        .nav-text {
            font-size: 0.7rem;
            color: var(--gray);
        }
        
        .nav-item.active .nav-text {
            color: var(--primary);
            font-weight: 600;
        }
        
        .page {
            display: none;
            padding: 0 0 10px 0;
        }
        
        .page.active {
            display: block;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: var(--shadow);
        }
        
        .card-title {
            font-size: 0.9rem;
            color: var(--primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            padding-bottom: 6px;
            border-bottom: 1px solid #ffeee6;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group label {
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .input-group input, .input-group select {
            padding: 10px 8px;
            border: 1px solid #ffe0d0;
            border-radius: var(--border-radius);
            font-size: 0.85rem;
            transition: all 0.3s;
            background: var(--light);
            width: 100%;
        }
        
        .input-group input:focus, .input-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 112, 67, 0.2);
        }
        
        .ratio-display {
            background: var(--light);
            padding: 10px 8px;
            border-radius: var(--border-radius);
            font-weight: 600;
            text-align: center;
            color: var(--primary);
            font-size: 0.85rem;
            border: 1px solid #ffe0d0;
        }
        
        .pitch-selector {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin: 12px 0;
        }
        
        .pitch-btn {
            padding: 10px 4px;
            background: var(--light);
            border: 1px solid #ffe0d0;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.75rem;
        }
        
        .pitch-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .calculate-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 6px;
            margin-top: 12px;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .result-item {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 12px;
            text-align: center;
            border: 1px solid #ffeee6;
        }
        
        .result-label {
            font-size: 0.7rem;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .result-value {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .system-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .system-card {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 12px;
            text-align: center;
            border: 1px solid #ffeee6;
        }
        
        .system-card h3 {
            font-size: 0.75rem;
            color: var(--dark);
            margin-bottom: 6px;
        }
        
        .system-card .value {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .recommendation {
            background: #e8f5e9;
            padding: 10px 12px;
            border-radius: var(--border-radius);
            border-left: 3px solid var(--success);
            font-size: 0.75rem;
            margin: 12px 0;
            color: var(--dark);
        }
        
        .recommendation h4 {
            color: var(--success);
            margin-bottom: 4px;
            font-size: 0.8rem;
        }
        
        .copy-btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, var(--success) 0%, #4caf50 100%);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
        }
        
        .footer {
            text-align: center;
            margin-top: 20px;
            color: var(--gray);
            font-size: 0.7rem;
        }
        
        .history-item {
            padding: 10px;
            border-bottom: 1px solid #ffeee6;
            font-size: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-content {
            flex: 1;
        }
        
        .history-actions {
            display: flex;
            gap: 8px;
        }
        
        .history-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--gray);
            transition: color 0.3s;
            padding: 4px;
        }
        
        .history-btn.copy {
            color: var(--success);
        }
        
        .history-btn.delete {
            color: var(--danger);
        }
        
        .clear-history {
            display: block;
            text-align: right;
            margin-top: 10px;
            color: var(--primary);
            font-size: 0.7rem;
            cursor: pointer;
            font-weight: 600;
        }
        
        .instruction-item {
            margin-bottom: 15px;
        }
        
        .instruction-item h3 {
            color: var(--primary);
            margin-bottom: 6px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .instruction-item p {
            color: var(--gray);
            font-size: 0.75rem;
            line-height: 1.5;
            padding-left: 24px;
        }
        
        /* 响应式调整 */
        @media (max-width: 340px) {
            .input-grid,
            .result-grid,
            .system-comparison {
                grid-template-columns: 1fr;
            }
            
            .pitch-selector {
                grid-template-columns: 1fr;
            }
            
            .nav-item {
                padding: 5px 8px;
                min-width: 50px;
            }
            
            .card {
                padding: 12px;
            }
        }
        
        @media (min-width: 400px) {
            body {
                font-size: 15px;
            }
            
            .container {
                padding: 0 12px;
            }
            
            .app-title {
                font-size: 1.3rem;
            }
            
            .app-subtitle {
                font-size: 0.8rem;
            }
        }
        
        /* 防止iOS缩放 */
        input[type="number"] {
            font-size: 16px !important;
        }
        
        @media screen and (-webkit-min-device-pixel-ratio:0) {
            select,
            textarea,
            input {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="app-header">
        <div class="app-title">自行车驱动系统换算工具</div>
        <div class="app-subtitle">链条与皮带系统专业转换计算</div>
    </div>
    
    <nav class="top-nav">
        <div class="nav-item active" data-page="calculatorPage">
            <i class="fas fa-calculator nav-icon"></i>
            <span class="nav-text">计算器</span>
        </div>
        <div class="nav-item" data-page="historyPage">
            <i class="fas fa-history nav-icon"></i>
            <span class="nav-text">计算记录</span>
        </div>
        <div class="nav-item" data-page="instructionsPage">
            <i class="fas fa-info-circle nav-icon"></i>
            <span class="nav-text">使用说明</span>
        </div>
    </nav>
    
    <div class="container">
        <!-- 计算器页面 -->
        <section id="calculatorPage" class="page active">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-cog"></i>当前链条系统</h2>
                
                <div class="input-grid">
                    <div class="input-group">
                        <label for="frontSprocket">前齿盘齿数 (T)</label>
                        <input type="number" id="frontSprocket" min="1" max="100" value="42">
                    </div>
                    
                    <div class="input-group">
                        <label for="rearSprocket">后齿盘齿数 (T)</label>
                        <input type="number" id="rearSprocket" min="1" max="100" value="16">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>当前齿比</label>
                    <div class="ratio-display" id="currentRatio">2.63</div>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-exchange-alt"></i>目标皮带系统</h2>
                
                <div class="pitch-selector">
                    <div class="pitch-btn active" data-pitch="11">11M 系统</div>
                    <div class="pitch-btn" data-pitch="10">10M 系统</div>
                    <div class="pitch-btn" data-pitch="8">8M 系统</div>
                </div>
                
                <div class="input-group">
                    <label for="hubType">花鼓接口类型</label>
                    <select id="hubType">
                        <option value="spline9">9花键</option>
                        <option value="threaded">旋飞</option>
                        <option value="3point3">3卡点-内3速</option>
                        <option value="3point578">3卡点-内5/7/8</option>
                        <option value="3point11">3卡点-内11</option>
                        <option value="other">其他类型</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="minRearTeeth">最小齿数 (T)</label>
                    <input type="number" id="minRearTeeth" min="1" max="100" value="20">
                    <small style="margin-top: 4px; color: var(--gray); font-size: 0.7rem;">根据花鼓接口类型自动推荐，可自行调整</small>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-sliders-h"></i>推荐齿比</h2>
                
                <div class="recommendation">
                    <h4>推荐齿比</h4>
                    <p id="recommendedRatio">根据您的设置，推荐齿比为: --</p>
                    <p id="recommendedTeeth" style="margin-top: 4px;">前轮: --T, 后轮: --T</p>
                </div>
                
                <div class="input-grid">
                    <div class="input-group">
                        <label for="frontPulleyInput">前皮带轮齿数 (T)</label>
                        <input type="number" id="frontPulleyInput" min="1" max="100" value="">
                    </div>
                    
                    <div class="input-group">
                        <label for="rearPulleyInput">后皮带轮齿数 (T)</label>
                        <input type="number" id="rearPulleyInput" min="1" max="100" value="">
                    </div>
                </div>
                
                <button class="calculate-btn" id="calculateFinalBtn">
                    <i class="fas fa-calculator"></i> 计算最终结果
                </button>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-chart-line"></i>计算结果</h2>
                
                <div class="result-grid">
                    <div class="result-item">
                        <div class="result-label">前皮带轮齿数</div>
                        <div class="result-value" id="frontPulley">--</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">后皮带轮齿数</div>
                        <div class="result-value" id="rearPulley">--</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">前外径≈</div>
                        <div class="result-value" id="frontOD">--</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">后外径≈</div>
                        <div class="result-value" id="rearOD">--</div>
                    </div>
                </div>
                
                <div class="system-comparison">
                    <div class="system-card">
                        <h3>链条系统齿比</h3>
                        <div class="value" id="chainRatio">2.63</div>
                    </div>
                    
                    <div class="system-card">
                        <h3>皮带系统齿比</h3>
                        <div class="value" id="beltRatio">--</div>
                    </div>
                </div>
                
                <button class="copy-btn" id="copyBtn">
                    <i class="fas fa-copy"></i> 复制计算结果
                </button>
            </div>
        </section>
        
        <!-- 历史记录页面 -->
        <section id="historyPage" class="page">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-history"></i> 计算历史</h2>
                <div class="history-list" id="historyList">
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <p>暂无计算历史</p>
                    </div>
                </div>
                <span class="clear-history" id="clearHistory">清除历史</span>
            </div>
        </section>
        
        <!-- 使用说明页面 -->
        <section id="instructionsPage" class="page">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-info-circle"></i> 使用说明</h2>
                
                <div class="instruction-item">
                    <h3><i class="fas fa-1"></i> 输入当前系统参数</h3>
                    <p>输入您当前自行车的前后齿盘齿数，系统会自动计算齿比。</p>
                </div>
                
                <div class="instruction-item">
                    <h3><i class="fas fa-2"></i> 选择目标皮带系统</h3>
                    <p>根据您的需求选择皮带系统类型：8M、10M或11M。</p>
                </div>
                
                <div class="instruction-item">
                    <h3><i class="fas fa-3"></i> 选择花鼓接口类型</h3>
                    <p>根据您的花鼓类型选择相应的接口，系统会自动推荐最小齿数。选择"其他类型"可自定义最小齿数。</p>
                </div>
                
                <div class="instruction-item">
                    <h3><i class="fas fa-4"></i> 查看推荐齿比</h3>
                    <p>系统会根据您的设置自动计算出推荐的皮带轮齿数。</p>
                </div>
                
                <div class="instruction-item">
                    <h3><i class="fas fa-5"></i> 调整齿数</h3>
                    <p>根据推荐齿比，您可以进一步调整前后皮带轮的齿数，然后点击"计算最终结果"。</p>
                </div>
                
                <div class="instruction-item">
                    <h3><i class="fas fa-6"></i> 查看最终结果</h3>
                    <p>系统会显示最终的皮带轮齿数、外径和齿比，您可以复制结果或查看历史记录。</p>
                </div>
            </div>
        </section>
        
        <div class="footer">
            <p>© 2023 自行车驱动系统换算工具 | 专业链条与皮带系统转换计算</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const frontSprocketInput = document.getElementById('frontSprocket');
            const rearSprocketInput = document.getElementById('rearSprocket');
            const currentRatioDisplay = document.getElementById('currentRatio');
            const pitchButtons = document.querySelectorAll('.pitch-btn');
            const hubTypeSelect = document.getElementById('hubType');
            const minRearTeethInput = document.getElementById('minRearTeeth');
            const frontPulleyInput = document.getElementById('frontPulleyInput');
            const rearPulleyInput = document.getElementById('rearPulleyInput');
            const frontPulleyDisplay = document.getElementById('frontPulley');
            const rearPulleyDisplay = document.getElementById('rearPulley');
            const frontODDisplay = document.getElementById('frontOD');
            const rearODDisplay = document.getElementById('rearOD');
            const chainRatioDisplay = document.getElementById('chainRatio');
            const beltRatioDisplay = document.getElementById('beltRatio');
            const copyBtn = document.getElementById('copyBtn');
            const calculateFinalBtn = document.getElementById('calculateFinalBtn');
            const recommendedRatio = document.getElementById('recommendedRatio');
            const recommendedTeeth = document.getElementById('recommendedTeeth');
            const navItems = document.querySelectorAll('.nav-item');
            const pages = document.querySelectorAll('.page');
            const historyList = document.getElementById('historyList');
            const clearHistoryBtn = document.getElementById('clearHistory');
            
            // 当前选择的节距
            let currentPitch = 11;
            let calculationHistory = [];
            
            // 初始化
            updateCurrentRatio();
            updateMinTeeth();
            updateRecommendation();
            
            // 事件监听 - 输入变化时自动计算
            frontSprocketInput.addEventListener('input', function() {
                updateCurrentRatio();
                updateRecommendation();
            });
            
            rearSprocketInput.addEventListener('input', function() {
                updateCurrentRatio();
                updateRecommendation();
            });
            
            pitchButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    pitchButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentPitch = parseInt(this.getAttribute('data-pitch'));
                    updateMinTeeth();
                    updateRecommendation();
                });
            });
            
            hubTypeSelect.addEventListener('change', function() {
                updateMinTeeth();
                updateRecommendation();
            });
            
            minRearTeethInput.addEventListener('input', function() {
                updateRecommendation();
            });
            
            calculateFinalBtn.addEventListener('click', calculateFinal);
            
            copyBtn.addEventListener('click', copyResults);
            
            // 导航切换
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const targetPage = this.getAttribute('data-page');
                    
                    // 更新导航状态
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 更新页面显示
                    pages.forEach(page => page.classList.remove('active'));
                    document.getElementById(targetPage).classList.add('active');
                    
                    // 如果是历史记录页面，更新显示
                    if (targetPage === 'historyPage') {
                        updateHistoryDisplay();
                    }
                });
            });
            
            clearHistoryBtn.addEventListener('click', function() {
                calculationHistory = [];
                updateHistoryDisplay();
            });
            
            // 更新最小齿数
            function updateMinTeeth() {
                const hubType = hubTypeSelect.value;
                
                let minTeeth = 20;
                
                // 根据皮带系统和花鼓类型确定最小齿数
                if (currentPitch === 8) {
                    if (hubType === 'spline9') minTeeth = 22;
                    else if (hubType === 'threaded') minTeeth = 28;
                    else if (hubType === '3point3') minTeeth = 22;
                    else if (hubType === '3point578') minTeeth = 31;
                    else if (hubType === 'other') minTeeth = 20;
                } else if (currentPitch === 10) {
                    if (hubType === 'spline9') minTeeth = 18;
                    else if (hubType === 'threaded') minTeeth = 22;
                    else if (hubType === '3point3') minTeeth = 20;
                    else if (hubType === '3point578') minTeeth = 38;
                    else if (hubType === '3point11') minTeeth = 38;
                    else if (hubType === 'other') minTeeth = 20;
                } else if (currentPitch === 11) {
                    if (hubType === 'spline9') minTeeth = 20;
                    else if (hubType === 'threaded') minTeeth = 20;
                    else if (hubType === '3point3') minTeeth = 20;
                    else if (hubType === '3point578') minTeeth = 22;
                    else if (hubType === '3point11') minTeeth = 30;
                    else if (hubType === 'other') minTeeth = 20;
                }
                
                minRearTeethInput.value = minTeeth;
            }
            
            // 更新当前齿比
            function updateCurrentRatio() {
                const front = parseFloat(frontSprocketInput.value) || 0;
                const rear = parseFloat(rearSprocketInput.value) || 0;
                
                if (front > 0 && rear > 0) {
                    const ratio = (rear / front).toFixed(2);
                    currentRatioDisplay.textContent = ratio;
                    chainRatioDisplay.textContent = ratio;
                } else {
                    currentRatioDisplay.textContent = '--';
                    chainRatioDisplay.textContent = '--';
                }
            }
            
            // 更新推荐齿比
            function updateRecommendation() {
                const frontSprocket = parseFloat(frontSprocketInput.value) || 0;
                const rearSprocket = parseFloat(rearSprocketInput.value) || 0;
                const minRearTeeth = parseFloat(minRearTeethInput.value) || 0;
                
                if (frontSprocket <= 0 || rearSprocket <= 0 || minRearTeeth <= 0) {
                    recommendedRatio.textContent = '根据您的设置，推荐齿比为: --';
                    recommendedTeeth.textContent = '前轮: --T, 后轮: --T';
                    frontPulleyInput.value = '';
                    rearPulleyInput.value = '';
                    return;
                }
                
                // 链条系统节距 (12.7mm)
                const chainPitch = 12.7;
                
                // 计算皮带轮齿数
                const recommendedFrontPulley = Math.round((chainPitch / currentPitch) * frontSprocket);
                let recommendedRearPulley = Math.round((chainPitch / currentPitch) * rearSprocket);
                
                // 检查后轮齿数是否满足最小限制
                if (recommendedRearPulley < minRearTeeth) {
                    recommendedRearPulley = minRearTeeth;
                }
                
                // 计算皮带系统齿比
                const beltRatio = (recommendedRearPulley / recommendedFrontPulley).toFixed(2);
                
                // 更新推荐显示
                recommendedRatio.textContent = `根据您的设置，推荐齿比为: ${beltRatio}`;
                recommendedTeeth.textContent = `前轮: ${recommendedFrontPulley}T, 后轮: ${recommendedRearPulley}T`;
                
                // 填充到调整输入框
                frontPulleyInput.value = recommendedFrontPulley;
                rearPulleyInput.value = recommendedRearPulley;
            }
            
            // 计算最终结果
            function calculateFinal() {
                const frontPulley = parseFloat(frontPulleyInput.value) || 0;
                const rearPulley = parseFloat(rearPulleyInput.value) || 0;
                
                if (frontPulley <= 0 || rearPulley <= 0) {
                    alert('请输入有效的前后皮带轮齿数');
                    return;
                }
                
                // 计算外径
                const frontOD = calculateOD(frontPulley, currentPitch);
                const rearOD = calculateOD(rearPulley, currentPitch);
                
                // 计算皮带系统齿比
                const beltRatio = (rearPulley / frontPulley).toFixed(2);
                
                // 更新显示
                frontPulleyDisplay.textContent = `${frontPulley}T`;
                rearPulleyDisplay.textContent = `${rearPulley}T`;
                frontODDisplay.textContent = `${frontOD.toFixed(1)}mm`;
                rearODDisplay.textContent = `${rearOD.toFixed(1)}mm`;
                beltRatioDisplay.textContent = beltRatio;
                
                // 存储计算结果
                const result = {
                    timestamp: new Date(),
                    frontSprocket: parseFloat(frontSprocketInput.value) || 0,
                    rearSprocket: parseFloat(rearSprocketInput.value) || 0,
                    pitch: currentPitch,
                    hubType: hubTypeSelect.options[hubTypeSelect.selectedIndex].text,
                    minTeeth: parseFloat(minRearTeethInput.value) || 0,
                    frontPulley: frontPulley,
                    rearPulley: rearPulley,
                    frontOD: frontOD,
                    rearOD: rearOD,
                    beltRatio: beltRatio
                };
                
                // 添加到历史记录
                addToHistory(result);
            }
            
            // 计算外径
            function calculateOD(teeth, pitch) {
                // 计算节圆直径
                const pcd = pitch / Math.sin(Math.PI / teeth);
                // 皮带轮外径 = 节圆直径 - (2 * 0.1 * 节距)
                return pcd - (2 * 0.1 * pitch);
            }
            
            // 添加到历史记录
            function addToHistory(result) {
                // 检查是否与最新记录相同
                if (calculationHistory.length > 0) {
                    const lastRecord = calculationHistory[0];
                    if (
                        lastRecord.frontSprocket === result.frontSprocket &&
                        lastRecord.rearSprocket === result.rearSprocket &&
                        lastRecord.pitch === result.pitch &&
                        lastRecord.hubType === result.hubType &&
                        lastRecord.minTeeth === result.minTeeth &&
                        lastRecord.frontPulley === result.frontPulley &&
                        lastRecord.rearPulley === result.rearPulley
                    ) {
                        return; // 相同记录不重复添加
                    }
                }
                
                calculationHistory.unshift(result);
                
                // 限制历史记录数量
                if (calculationHistory.length > 10) {
                    calculationHistory = calculationHistory.slice(0, 10);
                }
                
                // 更新历史记录显示
                updateHistoryDisplay();
            }
            
            // 更新历史记录显示
            function updateHistoryDisplay() {
                if (calculationHistory.length === 0) {
                    historyList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-history"></i>
                            <p>暂无计算历史</p>
                        </div>
                    `;
                    return;
                }
                
                historyList.innerHTML = '';
                
                calculationHistory.forEach((item, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    
                    historyItem.innerHTML = `
                        <div class="history-content">
                            ${item.frontSprocket}T/${item.rearSprocket}T → ${item.pitch}M: ${item.frontPulley}T/${item.rearPulley}T
                        </div>
                        <div class="history-actions">
                            <button class="history-btn copy" data-index="${index}">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="history-btn delete" data-index="${index}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    historyList.appendChild(historyItem);
                });
                
                // 添加复制和删除事件监听
                document.querySelectorAll('.history-btn.copy').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        copyHistoryItem(index);
                    });
                });
                
                document.querySelectorAll('.history-btn.delete').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        deleteHistoryItem(index);
                    });
                });
            }
            
            // 复制历史记录项
            function copyHistoryItem(index) {
                const item = calculationHistory[index];
                const text = `链条系统: ${item.frontSprocket}T/${item.rearSprocket}T
皮带系统(${item.pitch}M): ${item.frontPulley}T/${item.rearPulley}T
前外径: ${item.frontOD.toFixed(1)}mm, 后外径: ${item.rearOD.toFixed(1)}mm
链条齿比: ${(item.rearSprocket/item.frontSprocket).toFixed(2)}, 皮带齿比: ${item.beltRatio}
花鼓接口: ${item.hubType}
最小齿数限制: ${item.minTeeth}T`;
                
                // 创建临时文本区域进行复制
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    alert('计算结果已复制到剪贴板');
                } catch (err) {
                    alert('复制失败，请手动复制');
                }
                
                document.body.removeChild(textArea);
            }
            
            // 删除历史记录项
            function deleteHistoryItem(index) {
                calculationHistory.splice(index, 1);
                updateHistoryDisplay();
            }
            
            // 复制结果
            function copyResults() {
                const frontPulley = frontPulleyDisplay.textContent;
                const rearPulley = rearPulleyDisplay.textContent;
                
                if (frontPulley === '--' || rearPulley === '--') {
                    alert('请先计算有效的结果');
                    return;
                }
                
                const hubTypeText = hubTypeSelect.options[hubTypeSelect.selectedIndex].text;
                
                const text = `链条系统: ${frontSprocketInput.value}T/${rearSprocketInput.value}T
皮带系统(${currentPitch}M): ${frontPulley}/${rearPulley}
前外径: ${frontODDisplay.textContent}, 后外径: ${rearODDisplay.textContent}
链条齿比: ${chainRatioDisplay.textContent}, 皮带齿比: ${beltRatioDisplay.textContent}
花鼓接口: ${hubTypeText}
最小齿数限制: ${minRearTeethInput.value}T`;
                
                // 创建临时文本区域进行复制
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    alert('计算结果已复制到剪贴板');
                } catch (err) {
                    alert('复制失败，请手动复制');
                }
                
                document.body.removeChild(textArea);
            }
        });
    </script>
</body>
</html>